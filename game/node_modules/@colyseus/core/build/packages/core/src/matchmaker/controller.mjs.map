{"version":3,"file":"controller.mjs","sources":["../../../../../src/matchmaker/controller.ts"],"sourcesContent":["/**\n * Matchmaking controller\n * (for interoperability between different http frameworks, e.g. express, uWebSockets.js, etc)\n */\n\nimport { ErrorCode } from \"../Protocol\";\nimport { ServerError } from \"../errors/ServerError\";\nimport * as matchMaker from \"../MatchMaker\";\n\nexport const exposedMethods = ['joinOrCreate', 'create', 'join', 'joinById'];\nexport const allowedRoomNameChars = /([a-zA-Z_\\-0-9]+)/gi;\nexport const matchmakeRoute = 'matchmake';\n\nexport function getAvailableRooms(roomName: string) {\n    /**\n    * list public & unlocked rooms\n    */\n    const conditions: any = {\n        locked: false,\n        private: false,\n    };\n    if (roomName) {\n        conditions[\"name\"] = roomName;\n    }\n    return matchMaker.query(conditions);\n}\n\nexport async function invokeMethod(method: string, roomName: string, clientOptions: any = {}) {\n    if (exposedMethods.indexOf(method) === -1) {\n        throw new ServerError(ErrorCode.MATCHMAKE_NO_HANDLER, `invalid method \"${method}\"`);\n    }\n\n    try {\n        return await matchMaker[method](roomName, clientOptions);\n\n    } catch (e) {\n        throw new ServerError(e.code || ErrorCode.MATCHMAKE_UNHANDLED, e.message);\n    }\n}\n"],"names":["matchMaker.query","matchMaker"],"mappings":";;;;;AAAA;;;;MASa,cAAc,GAAG,CAAC,cAAc,EAAE,QAAQ,EAAE,MAAM,EAAE,UAAU,EAAE;MAChE,oBAAoB,GAAG,sBAAsB;MAC7C,cAAc,GAAG,YAAY;SAE1B,iBAAiB,CAAC,QAAgB;;;;IAI9C,MAAM,UAAU,GAAQ;QACpB,MAAM,EAAE,KAAK;QACb,OAAO,EAAE,KAAK;KACjB,CAAC;IACF,IAAI,QAAQ,EAAE;QACV,UAAU,CAAC,MAAM,CAAC,GAAG,QAAQ,CAAC;KACjC;IACD,OAAOA,KAAgB,CAAC,UAAU,CAAC,CAAC;AACxC,CAAC;AAEM,eAAe,YAAY,CAAC,MAAc,EAAE,QAAgB,EAAE,gBAAqB,EAAE;IACxF,IAAI,cAAc,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE;QACvC,MAAM,IAAI,WAAW,CAAC,SAAS,CAAC,oBAAoB,EAAE,mBAAmB,MAAM,GAAG,CAAC,CAAC;KACvF;IAED,IAAI;QACA,OAAO,MAAMC,UAAU,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,aAAa,CAAC,CAAC;KAE5D;IAAC,OAAO,CAAC,EAAE;QACR,MAAM,IAAI,WAAW,CAAC,CAAC,CAAC,IAAI,IAAI,SAAS,CAAC,mBAAmB,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;KAC7E;AACL;;;;"}