{"version":3,"file":"WebSocketClient.mjs.js","sources":["../../../../../../transport/ws-transport/build/WebSocketClient.mjs"],"sourcesContent":["import WebSocket from 'ws';\nimport { ClientState, getMessageBytes, Protocol, logger } from '@colyseus/core';\nimport { Schema } from '@colyseus/schema';\n\nconst SEND_OPTS = { binary: true };\nclass WebSocketClient {\n    id;\n    ref;\n    sessionId;\n    state = ClientState.JOINING;\n    _enqueuedMessages = [];\n    _afterNextPatchQueue;\n    constructor(id, ref) {\n        this.id = id;\n        this.ref = ref;\n        this.sessionId = id;\n    }\n    send(messageOrType, messageOrOptions, options) {\n        this.enqueueRaw((messageOrType instanceof Schema)\n            ? getMessageBytes[Protocol.ROOM_DATA_SCHEMA](messageOrType)\n            : getMessageBytes[Protocol.ROOM_DATA](messageOrType, messageOrOptions), options);\n    }\n    enqueueRaw(data, options) {\n        // use room's afterNextPatch queue\n        if (options?.afterNextPatch) {\n            this._afterNextPatchQueue.push([this, arguments]);\n            return;\n        }\n        if (this.state === ClientState.JOINING) {\n            // sending messages during `onJoin`.\n            // - the client-side cannot register \"onMessage\" callbacks at this point.\n            // - enqueue the messages to be send after JOIN_ROOM message has been sent\n            this._enqueuedMessages.push(data);\n            return;\n        }\n        this.raw(data, options);\n    }\n    raw(data, options, cb) {\n        if (this.ref.readyState !== WebSocket.OPEN) {\n            logger.warn('trying to send data to inactive client', this.sessionId);\n            return;\n        }\n        this.ref.send(data, SEND_OPTS, cb);\n    }\n    error(code, message = '', cb) {\n        this.raw(getMessageBytes[Protocol.ERROR](code, message), undefined, cb);\n    }\n    get readyState() {\n        return this.ref.readyState;\n    }\n    leave(code, data) {\n        this.ref.close(code, data);\n    }\n    close(code, data) {\n        logger.warn('DEPRECATION WARNING: use client.leave() instead of client.close()');\n        try {\n            throw new Error();\n        }\n        catch (e) {\n            logger.info(e.stack);\n        }\n        this.leave(code, data);\n    }\n    toJSON() {\n        return { sessionId: this.sessionId, readyState: this.readyState };\n    }\n}\n\nexport { WebSocketClient };\n//# sourceMappingURL=WebSocketClient.mjs.map\n"],"names":["ClientState","Schema","getMessageBytes","Protocol","WebSocket","logger"],"mappings":"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"}