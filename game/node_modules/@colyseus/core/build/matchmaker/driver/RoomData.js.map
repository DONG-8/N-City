{"version":3,"file":"RoomData.js","sources":["../../../src/matchmaker/driver/RoomData.ts"],"sourcesContent":["import { spliceOne } from '../../Utils';\nimport { RoomListingData } from './interfaces';\n\nexport class RoomCache implements RoomListingData {\n  public clients: number = 0;\n  public locked: boolean = false;\n  public private: boolean = false;\n  public maxClients: number = Infinity;\n  public metadata: any;\n  public name: string;\n  public processId: string;\n  public roomId: string;\n  public createdAt: Date;\n  public unlisted: boolean = false;\n\n  private $rooms: RoomCache[];\n\n  constructor(initialValues: any, rooms: RoomCache[]) {\n    this.createdAt = new Date();\n\n    for (const field in initialValues) {\n      if (initialValues.hasOwnProperty(field)) {\n        this[field] = initialValues[field];\n      }\n    }\n\n    this.$rooms = rooms;\n  }\n\n  public toJSON() {\n    return {\n      clients: this.clients,\n      createdAt: this.createdAt,\n      maxClients: this.maxClients,\n      metadata: this.metadata,\n      name: this.name,\n      processId: this.processId,\n      roomId: this.roomId,\n    };\n  }\n\n  public save() {\n    if (this.$rooms.indexOf(this) === -1) {\n      this.$rooms.push(this);\n    }\n  }\n\n  public updateOne(operations: any) {\n    if (operations.$set) {\n      for (const field in operations.$set) {\n        if (operations.$set.hasOwnProperty(field)) {\n          this[field] = operations.$set[field];\n        }\n      }\n    }\n\n    if (operations.$inc) {\n      for (const field in operations.$inc) {\n        if (operations.$inc.hasOwnProperty(field)) {\n          this[field] += operations.$inc[field];\n        }\n      }\n    }\n  }\n\n  public remove() {\n    //\n    // WORKAROUND: prevent calling `.remove()` multiple times\n    // Seems to happen during disconnect + dispose: https://github.com/colyseus/colyseus/issues/390\n    //\n    if (!this.$rooms) { return; }\n\n    const roomIndex = this.$rooms.indexOf(this);\n    if (roomIndex === -1) { return; }\n\n    spliceOne(this.$rooms, roomIndex);\n    this.$rooms = null;\n  }\n}\n"],"names":["spliceOne"],"mappings":";;;;;;MAGa,SAAS;IACb,OAAO,GAAW,CAAC,CAAC;IACpB,MAAM,GAAY,KAAK,CAAC;IACxB,OAAO,GAAY,KAAK,CAAC;IACzB,UAAU,GAAW,QAAQ,CAAC;IAC9B,QAAQ,CAAM;IACd,IAAI,CAAS;IACb,SAAS,CAAS;IAClB,MAAM,CAAS;IACf,SAAS,CAAO;IAChB,QAAQ,GAAY,KAAK,CAAC;IAEzB,MAAM,CAAc;IAE5B,YAAY,aAAkB,EAAE,KAAkB;QAChD,IAAI,CAAC,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC;QAE5B,KAAK,MAAM,KAAK,IAAI,aAAa,EAAE;YACjC,IAAI,aAAa,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;gBACvC,IAAI,CAAC,KAAK,CAAC,GAAG,aAAa,CAAC,KAAK,CAAC,CAAC;aACpC;SACF;QAED,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;KACrB;IAEM,MAAM;QACX,OAAO;YACL,OAAO,EAAE,IAAI,CAAC,OAAO;YACrB,SAAS,EAAE,IAAI,CAAC,SAAS;YACzB,UAAU,EAAE,IAAI,CAAC,UAAU;YAC3B,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,SAAS,EAAE,IAAI,CAAC,SAAS;YACzB,MAAM,EAAE,IAAI,CAAC,MAAM;SACpB,CAAC;KACH;IAEM,IAAI;QACT,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE;YACpC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACxB;KACF;IAEM,SAAS,CAAC,UAAe;QAC9B,IAAI,UAAU,CAAC,IAAI,EAAE;YACnB,KAAK,MAAM,KAAK,IAAI,UAAU,CAAC,IAAI,EAAE;gBACnC,IAAI,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;oBACzC,IAAI,CAAC,KAAK,CAAC,GAAG,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;iBACtC;aACF;SACF;QAED,IAAI,UAAU,CAAC,IAAI,EAAE;YACnB,KAAK,MAAM,KAAK,IAAI,UAAU,CAAC,IAAI,EAAE;gBACnC,IAAI,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;oBACzC,IAAI,CAAC,KAAK,CAAC,IAAI,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;iBACvC;aACF;SACF;KACF;IAEM,MAAM;;;;;QAKX,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YAAE,OAAO;SAAE;QAE7B,MAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAC5C,IAAI,SAAS,KAAK,CAAC,CAAC,EAAE;YAAE,OAAO;SAAE;QAEjCA,eAAS,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC;QAClC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;KACpB;;;;;"}