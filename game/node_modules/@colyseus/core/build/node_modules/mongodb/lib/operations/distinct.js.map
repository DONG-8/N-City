{"version":3,"file":"distinct.js","sources":["../../../../../../../node_modules/mongodb/lib/operations/distinct.js"],"sourcesContent":["'use strict';\n\nconst Aspect = require('./operation').Aspect;\nconst defineAspects = require('./operation').defineAspects;\nconst CommandOperationV2 = require('./command_v2');\nconst decorateWithCollation = require('../utils').decorateWithCollation;\nconst decorateWithReadConcern = require('../utils').decorateWithReadConcern;\nconst maxWireVersion = require('../core/utils').maxWireVersion;\nconst MongoError = require('../error').MongoError;\n\n/**\n * Return a list of distinct values for the given key across a collection.\n *\n * @class\n * @property {Collection} a Collection instance.\n * @property {string} key Field of the document to find distinct values for.\n * @property {object} query The query for filtering the set of documents to which we apply the distinct filter.\n * @property {object} [options] Optional settings. See Collection.prototype.distinct for a list of options.\n */\nclass DistinctOperation extends CommandOperationV2 {\n  /**\n   * Construct a Distinct operation.\n   *\n   * @param {Collection} a Collection instance.\n   * @param {string} key Field of the document to find distinct values for.\n   * @param {object} query The query for filtering the set of documents to which we apply the distinct filter.\n   * @param {object} [options] Optional settings. See Collection.prototype.distinct for a list of options.\n   */\n  constructor(collection, key, query, options) {\n    super(collection, options);\n\n    this.collection = collection;\n    this.key = key;\n    this.query = query;\n  }\n\n  /**\n   * Execute the operation.\n   *\n   * @param {Collection~resultCallback} [callback] The command result callback\n   */\n  execute(server, callback) {\n    const coll = this.collection;\n    const key = this.key;\n    const query = this.query;\n    const options = this.options;\n\n    // Distinct command\n    const cmd = {\n      distinct: coll.collectionName,\n      key: key,\n      query: query\n    };\n\n    // Add maxTimeMS if defined\n    if (typeof options.maxTimeMS === 'number') {\n      cmd.maxTimeMS = options.maxTimeMS;\n    }\n\n    // Do we have a readConcern specified\n    decorateWithReadConcern(cmd, coll, options);\n\n    // Have we specified collation\n    try {\n      decorateWithCollation(cmd, coll, options);\n    } catch (err) {\n      return callback(err, null);\n    }\n\n    if (this.explain && maxWireVersion(server) < 4) {\n      callback(new MongoError(`server does not support explain on distinct`));\n      return;\n    }\n\n    super.executeCommand(server, cmd, (err, result) => {\n      if (err) {\n        callback(err);\n        return;\n      }\n\n      callback(null, this.options.full || this.explain ? result : result.values);\n    });\n  }\n}\n\ndefineAspects(DistinctOperation, [\n  Aspect.READ_OPERATION,\n  Aspect.RETRYABLE,\n  Aspect.EXECUTE_WITH_SELECTION,\n  Aspect.EXPLAINABLE\n]);\n\nmodule.exports = DistinctOperation;\n"],"names":["require$$0","require$$1","require$$2","require$$3","CommandOperationV2"],"mappings":"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"}