{"version":3,"file":"kill_cursors.mjs","sources":["../../../../../../../../node_modules/mongodb/lib/core/wireprotocol/kill_cursors.js"],"sourcesContent":["'use strict';\n\nconst KillCursor = require('../connection/commands').KillCursor;\nconst MongoError = require('../error').MongoError;\nconst MongoNetworkError = require('../error').MongoNetworkError;\nconst collectionNamespace = require('./shared').collectionNamespace;\nconst maxWireVersion = require('../utils').maxWireVersion;\nconst emitWarning = require('../utils').emitWarning;\nconst command = require('./command');\n\nfunction killCursors(server, ns, cursorState, callback) {\n  callback = typeof callback === 'function' ? callback : () => {};\n  const cursorId = cursorState.cursorId;\n\n  if (maxWireVersion(server) < 4) {\n    const bson = server.s.bson;\n    const pool = server.s.pool;\n    const killCursor = new KillCursor(bson, ns, [cursorId]);\n    const options = {\n      immediateRelease: true,\n      noResponse: true\n    };\n\n    if (typeof cursorState.session === 'object') {\n      options.session = cursorState.session;\n    }\n\n    if (pool && pool.isConnected()) {\n      try {\n        pool.write(killCursor, options, callback);\n      } catch (err) {\n        if (typeof callback === 'function') {\n          callback(err, null);\n        } else {\n          emitWarning(err);\n        }\n      }\n    }\n\n    return;\n  }\n\n  const killCursorCmd = {\n    killCursors: collectionNamespace(ns),\n    cursors: [cursorId]\n  };\n\n  const options = {};\n  if (typeof cursorState.session === 'object') options.session = cursorState.session;\n\n  command(server, ns, killCursorCmd, options, (err, result) => {\n    if (err) {\n      return callback(err);\n    }\n\n    const response = result.message;\n    if (response.cursorNotFound) {\n      return callback(new MongoNetworkError('cursor killed or timed out'), null);\n    }\n\n    if (!Array.isArray(response.documents) || response.documents.length === 0) {\n      return callback(\n        new MongoError(`invalid killCursors result returned for cursor id ${cursorId}`)\n      );\n    }\n\n    callback(null, response.documents[0]);\n  });\n}\n\nmodule.exports = killCursors;\n"],"names":["require$$0","require$$1","require$$2","require$$3","command"],"mappings":"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"}