{"version":3,"file":"create_collection.js","sources":["../../../../../../../node_modules/mongodb/lib/operations/create_collection.js"],"sourcesContent":["'use strict';\n\nconst Aspect = require('./operation').Aspect;\nconst defineAspects = require('./operation').defineAspects;\nconst CommandOperation = require('./command');\nconst applyWriteConcern = require('../utils').applyWriteConcern;\nconst loadCollection = require('../dynamic_loaders').loadCollection;\nconst MongoError = require('../core').MongoError;\nconst ReadPreference = require('../core').ReadPreference;\n\nconst ILLEGAL_COMMAND_FIELDS = new Set([\n  'w',\n  'wtimeout',\n  'j',\n  'fsync',\n  'autoIndexId',\n  'strict',\n  'serializeFunctions',\n  'pkFactory',\n  'raw',\n  'readPreference',\n  'session',\n  'readConcern',\n  'writeConcern'\n]);\n\nclass CreateCollectionOperation extends CommandOperation {\n  constructor(db, name, options) {\n    super(db, options);\n    this.name = name;\n  }\n\n  _buildCommand() {\n    const name = this.name;\n    const options = this.options;\n\n    const cmd = { create: name };\n    for (let n in options) {\n      if (\n        options[n] != null &&\n        typeof options[n] !== 'function' &&\n        !ILLEGAL_COMMAND_FIELDS.has(n)\n      ) {\n        cmd[n] = options[n];\n      }\n    }\n\n    return cmd;\n  }\n\n  execute(callback) {\n    const db = this.db;\n    const name = this.name;\n    const options = this.options;\n    const Collection = loadCollection();\n\n    let listCollectionOptions = Object.assign({ nameOnly: true, strict: false }, options);\n    listCollectionOptions = applyWriteConcern(listCollectionOptions, { db }, listCollectionOptions);\n\n    function done(err) {\n      if (err) {\n        return callback(err);\n      }\n\n      try {\n        callback(\n          null,\n          new Collection(db, db.s.topology, db.databaseName, name, db.s.pkFactory, options)\n        );\n      } catch (err) {\n        callback(err);\n      }\n    }\n\n    const strictMode = listCollectionOptions.strict;\n    if (strictMode) {\n      db.listCollections({ name }, listCollectionOptions)\n        .setReadPreference(ReadPreference.PRIMARY)\n        .toArray((err, collections) => {\n          if (err) {\n            return callback(err);\n          }\n\n          if (collections.length > 0) {\n            return callback(\n              new MongoError(`Collection ${name} already exists. Currently in strict mode.`)\n            );\n          }\n\n          super.execute(done);\n        });\n\n      return;\n    }\n\n    // otherwise just execute the command\n    super.execute(done);\n  }\n}\n\ndefineAspects(CreateCollectionOperation, Aspect.WRITE_OPERATION);\nmodule.exports = CreateCollectionOperation;\n"],"names":["require$$0","require$$1","require$$2","require$$3","CommandOperation"],"mappings":";;;;;;;;AAEA,MAAM,MAAM,GAAGA,SAAsB,CAAC,MAAM,CAAC;AAC7C,MAAM,aAAa,GAAGA,SAAsB,CAAC,aAAa,CAAC;AACb;AAC9C,MAAM,iBAAiB,GAAGC,KAAmB,CAAC,iBAAiB,CAAC;AAChE,MAAM,cAAc,GAAGC,eAA6B,CAAC,cAAc,CAAC;AACpE,MAAM,UAAU,GAAGC,KAAkB,CAAC,UAAU,CAAC;AACjD,MAAM,cAAc,GAAGA,KAAkB,CAAC,cAAc,CAAC;AACzD;AACA,MAAM,sBAAsB,GAAG,IAAI,GAAG,CAAC;AACvC,EAAE,GAAG;AACL,EAAE,UAAU;AACZ,EAAE,GAAG;AACL,EAAE,OAAO;AACT,EAAE,aAAa;AACf,EAAE,QAAQ;AACV,EAAE,oBAAoB;AACtB,EAAE,WAAW;AACb,EAAE,KAAK;AACP,EAAE,gBAAgB;AAClB,EAAE,SAAS;AACX,EAAE,aAAa;AACf,EAAE,cAAc;AAChB,CAAC,CAAC,CAAC;AACH;AACA,MAAM,yBAAyB,SAASC,OAAgB,CAAC;AACzD,EAAE,WAAW,CAAC,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE;AACjC,IAAI,KAAK,CAAC,EAAE,EAAE,OAAO,CAAC,CAAC;AACvB,IAAI,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;AACrB,GAAG;AACH;AACA,EAAE,aAAa,GAAG;AAClB,IAAI,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;AAC3B,IAAI,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;AACjC;AACA,IAAI,MAAM,GAAG,GAAG,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC;AACjC,IAAI,KAAK,IAAI,CAAC,IAAI,OAAO,EAAE;AAC3B,MAAM;AACN,QAAQ,OAAO,CAAC,CAAC,CAAC,IAAI,IAAI;AAC1B,QAAQ,OAAO,OAAO,CAAC,CAAC,CAAC,KAAK,UAAU;AACxC,QAAQ,CAAC,sBAAsB,CAAC,GAAG,CAAC,CAAC,CAAC;AACtC,QAAQ;AACR,QAAQ,GAAG,CAAC,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;AAC5B,OAAO;AACP,KAAK;AACL;AACA,IAAI,OAAO,GAAG,CAAC;AACf,GAAG;AACH;AACA,EAAE,OAAO,CAAC,QAAQ,EAAE;AACpB,IAAI,MAAM,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;AACvB,IAAI,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;AAC3B,IAAI,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;AACjC,IAAI,MAAM,UAAU,GAAG,cAAc,EAAE,CAAC;AACxC;AACA,IAAI,IAAI,qBAAqB,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,EAAE,OAAO,CAAC,CAAC;AAC1F,IAAI,qBAAqB,GAAG,iBAAiB,CAAC,qBAAqB,EAAE,EAAE,EAAE,EAAE,EAAE,qBAAqB,CAAC,CAAC;AACpG;AACA,IAAI,SAAS,IAAI,CAAC,GAAG,EAAE;AACvB,MAAM,IAAI,GAAG,EAAE;AACf,QAAQ,OAAO,QAAQ,CAAC,GAAG,CAAC,CAAC;AAC7B,OAAO;AACP;AACA,MAAM,IAAI;AACV,QAAQ,QAAQ;AAChB,UAAU,IAAI;AACd,UAAU,IAAI,UAAU,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,YAAY,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC,SAAS,EAAE,OAAO,CAAC;AAC3F,SAAS,CAAC;AACV,OAAO,CAAC,OAAO,GAAG,EAAE;AACpB,QAAQ,QAAQ,CAAC,GAAG,CAAC,CAAC;AACtB,OAAO;AACP,KAAK;AACL;AACA,IAAI,MAAM,UAAU,GAAG,qBAAqB,CAAC,MAAM,CAAC;AACpD,IAAI,IAAI,UAAU,EAAE;AACpB,MAAM,EAAE,CAAC,eAAe,CAAC,EAAE,IAAI,EAAE,EAAE,qBAAqB,CAAC;AACzD,SAAS,iBAAiB,CAAC,cAAc,CAAC,OAAO,CAAC;AAClD,SAAS,OAAO,CAAC,CAAC,GAAG,EAAE,WAAW,KAAK;AACvC,UAAU,IAAI,GAAG,EAAE;AACnB,YAAY,OAAO,QAAQ,CAAC,GAAG,CAAC,CAAC;AACjC,WAAW;AACX;AACA,UAAU,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;AACtC,YAAY,OAAO,QAAQ;AAC3B,cAAc,IAAI,UAAU,CAAC,CAAC,WAAW,EAAE,IAAI,CAAC,0CAA0C,CAAC,CAAC;AAC5F,aAAa,CAAC;AACd,WAAW;AACX;AACA,UAAU,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAC9B,SAAS,CAAC,CAAC;AACX;AACA,MAAM,OAAO;AACb,KAAK;AACL;AACA;AACA,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AACxB,GAAG;AACH,CAAC;AACD;AACA,aAAa,CAAC,yBAAyB,EAAE,MAAM,CAAC,eAAe,CAAC,CAAC;qBACnD,GAAG;;;;"}