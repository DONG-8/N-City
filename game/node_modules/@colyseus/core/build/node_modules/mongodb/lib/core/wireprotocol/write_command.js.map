{"version":3,"file":"write_command.js","sources":["../../../../../../../../node_modules/mongodb/lib/core/wireprotocol/write_command.js"],"sourcesContent":["'use strict';\n\nconst MongoError = require('../error').MongoError;\nconst collectionNamespace = require('./shared').collectionNamespace;\nconst command = require('./command');\nconst decorateWithExplain = require('../../utils').decorateWithExplain;\nconst Explain = require('../../explain').Explain;\n\nfunction writeCommand(server, type, opsField, ns, ops, options, callback) {\n  if (ops.length === 0) throw new MongoError(`${type} must contain at least one document`);\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  options = options || {};\n  const ordered = typeof options.ordered === 'boolean' ? options.ordered : true;\n  const writeConcern = options.writeConcern;\n\n  let writeCommand = {};\n  writeCommand[type] = collectionNamespace(ns);\n  writeCommand[opsField] = ops;\n  writeCommand.ordered = ordered;\n\n  if (writeConcern && Object.keys(writeConcern).length > 0) {\n    writeCommand.writeConcern = writeConcern;\n  }\n\n  if (options.collation) {\n    for (let i = 0; i < writeCommand[opsField].length; i++) {\n      if (!writeCommand[opsField][i].collation) {\n        writeCommand[opsField][i].collation = options.collation;\n      }\n    }\n  }\n\n  if (options.bypassDocumentValidation === true) {\n    writeCommand.bypassDocumentValidation = options.bypassDocumentValidation;\n  }\n\n  // If a command is to be explained, we need to reformat the command after\n  // the other command properties are specified.\n  const explain = Explain.fromOptions(options);\n  if (explain) {\n    writeCommand = decorateWithExplain(writeCommand, explain);\n  }\n\n  const commandOptions = Object.assign(\n    {\n      checkKeys: type === 'insert',\n      numberToReturn: 1\n    },\n    options\n  );\n\n  command(server, ns, writeCommand, commandOptions, callback);\n}\n\nmodule.exports = writeCommand;\n"],"names":["require$$0","require$$1","require$$2","require$$3"],"mappings":";;;;;;;;AAEA,MAAM,UAAU,GAAGA,KAAmB,CAAC,UAAU,CAAC;AAClD,MAAM,mBAAmB,GAAGC,MAAmB,CAAC,mBAAmB,CAAC;AAC/B;AACrC,MAAM,mBAAmB,GAAGC,KAAsB,CAAC,mBAAmB,CAAC;AACvE,MAAM,OAAO,GAAGC,OAAwB,CAAC,OAAO,CAAC;AACjD;AACA,SAAS,YAAY,CAAC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,EAAE,EAAE,GAAG,EAAE,OAAO,EAAE,QAAQ,EAAE;AAC1E,EAAE,IAAI,GAAG,CAAC,MAAM,KAAK,CAAC,EAAE,MAAM,IAAI,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC,mCAAmC,CAAC,CAAC,CAAC;AAC3F,EAAE,IAAI,OAAO,OAAO,KAAK,UAAU,EAAE;AACrC,IAAI,QAAQ,GAAG,OAAO,CAAC;AACvB,IAAI,OAAO,GAAG,EAAE,CAAC;AACjB,GAAG;AACH;AACA,EAAE,OAAO,GAAG,OAAO,IAAI,EAAE,CAAC;AAC1B,EAAE,MAAM,OAAO,GAAG,OAAO,OAAO,CAAC,OAAO,KAAK,SAAS,GAAG,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC;AAChF,EAAE,MAAM,YAAY,GAAG,OAAO,CAAC,YAAY,CAAC;AAC5C;AACA,EAAE,IAAI,YAAY,GAAG,EAAE,CAAC;AACxB,EAAE,YAAY,CAAC,IAAI,CAAC,GAAG,mBAAmB,CAAC,EAAE,CAAC,CAAC;AAC/C,EAAE,YAAY,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC;AAC/B,EAAE,YAAY,CAAC,OAAO,GAAG,OAAO,CAAC;AACjC;AACA,EAAE,IAAI,YAAY,IAAI,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;AAC5D,IAAI,YAAY,CAAC,YAAY,GAAG,YAAY,CAAC;AAC7C,GAAG;AACH;AACA,EAAE,IAAI,OAAO,CAAC,SAAS,EAAE;AACzB,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC5D,MAAM,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE;AAChD,QAAQ,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,GAAG,OAAO,CAAC,SAAS,CAAC;AAChE,OAAO;AACP,KAAK;AACL,GAAG;AACH;AACA,EAAE,IAAI,OAAO,CAAC,wBAAwB,KAAK,IAAI,EAAE;AACjD,IAAI,YAAY,CAAC,wBAAwB,GAAG,OAAO,CAAC,wBAAwB,CAAC;AAC7E,GAAG;AACH;AACA;AACA;AACA,EAAE,MAAM,OAAO,GAAG,OAAO,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;AAC/C,EAAE,IAAI,OAAO,EAAE;AACf,IAAI,YAAY,GAAG,mBAAmB,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC;AAC9D,GAAG;AACH;AACA,EAAE,MAAM,cAAc,GAAG,MAAM,CAAC,MAAM;AACtC,IAAI;AACJ,MAAM,SAAS,EAAE,IAAI,KAAK,QAAQ;AAClC,MAAM,cAAc,EAAE,CAAC;AACvB,KAAK;AACL,IAAI,OAAO;AACX,GAAG,CAAC;AACJ;AACA,EAAE,OAAO,CAAC,MAAM,EAAE,EAAE,EAAE,YAAY,EAAE,cAAc,EAAE,QAAQ,CAAC,CAAC;AAC9D,CAAC;AACD;iBACc,GAAG;;;;"}