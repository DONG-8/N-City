'use strict';

var operation = require('./operation.js');
var utils = require('../utils.js');
var db_ops = require('./db_ops.js');

const OperationBase = operation.OperationBase;
const handleCallback = utils.handleCallback;
const indexInformationDb = db_ops.indexInformation;

class IndexExistsOperation extends OperationBase {
  constructor(collection, indexes, options) {
    super(options);

    this.collection = collection;
    this.indexes = indexes;
  }

  execute(callback) {
    const coll = this.collection;
    const indexes = this.indexes;
    const options = this.options;

    indexInformationDb(coll.s.db, coll.collectionName, options, (err, indexInformation) => {
      // If we have an error return
      if (err != null) return handleCallback(callback, err, null);
      // Let's check for the index names
      if (!Array.isArray(indexes))
        return handleCallback(callback, null, indexInformation[indexes] != null);
      // Check in list of indexes
      for (let i = 0; i < indexes.length; i++) {
        if (indexInformation[indexes[i]] == null) {
          return handleCallback(callback, null, false);
        }
      }

      // All keys found return true
      return handleCallback(callback, null, true);
    });
  }
}

var index_exists = IndexExistsOperation;

module.exports = index_exists;
//# sourceMappingURL=index_exists.js.map
