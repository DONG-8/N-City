'use strict';

var index = require('../core/index.js');
var find_and_modify = require('./find_and_modify.js');
var utils = require('../utils.js');

const MongoError = index.MongoError;

const hasAtomicOperators = utils.hasAtomicOperators;

class FindOneAndReplaceOperation extends find_and_modify {
  constructor(collection, filter, replacement, options) {
    if ('returnDocument' in options && 'returnOriginal' in options) {
      throw new MongoError(
        'findOneAndReplace option returnOriginal is deprecated in favor of returnDocument and cannot be combined'
      );
    }
    // Final options
    const finalOptions = Object.assign({}, options);
    finalOptions.fields = options.projection;
    finalOptions.update = true;
    finalOptions.new = options.returnDocument === 'after' || options.returnOriginal === false;
    finalOptions.upsert = options.upsert === true;

    if (filter == null || typeof filter !== 'object') {
      throw new TypeError('Filter parameter must be an object');
    }

    if (replacement == null || typeof replacement !== 'object') {
      throw new TypeError('Replacement parameter must be an object');
    }

    if (hasAtomicOperators(replacement)) {
      throw new TypeError('Replacement document must not contain atomic operators');
    }

    super(collection, filter, finalOptions.sort, replacement, finalOptions);
  }
}

var find_one_and_replace = FindOneAndReplaceOperation;

module.exports = find_one_and_replace;
//# sourceMappingURL=find_one_and_replace.js.map
