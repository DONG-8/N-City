{"version":3,"file":"rename.js","sources":["../../../../../../../node_modules/mongodb/lib/operations/rename.js"],"sourcesContent":["'use strict';\n\nconst OperationBase = require('./operation').OperationBase;\nconst applyWriteConcern = require('../utils').applyWriteConcern;\nconst checkCollectionName = require('../utils').checkCollectionName;\nconst executeDbAdminCommand = require('./db_ops').executeDbAdminCommand;\nconst handleCallback = require('../utils').handleCallback;\nconst loadCollection = require('../dynamic_loaders').loadCollection;\nconst toError = require('../utils').toError;\n\nclass RenameOperation extends OperationBase {\n  constructor(collection, newName, options) {\n    super(options);\n\n    this.collection = collection;\n    this.newName = newName;\n  }\n\n  execute(callback) {\n    const coll = this.collection;\n    const newName = this.newName;\n    const options = this.options;\n\n    let Collection = loadCollection();\n    // Check the collection name\n    checkCollectionName(newName);\n    // Build the command\n    const renameCollection = coll.namespace;\n    const toCollection = coll.s.namespace.withCollection(newName).toString();\n    const dropTarget = typeof options.dropTarget === 'boolean' ? options.dropTarget : false;\n    const cmd = { renameCollection: renameCollection, to: toCollection, dropTarget: dropTarget };\n\n    // Decorate command with writeConcern if supported\n    applyWriteConcern(cmd, { db: coll.s.db, collection: coll }, options);\n\n    // Execute against admin\n    executeDbAdminCommand(coll.s.db.admin().s.db, cmd, options, (err, doc) => {\n      if (err) return handleCallback(callback, err, null);\n      // We have an error\n      if (doc.errmsg) return handleCallback(callback, toError(doc), null);\n      try {\n        return handleCallback(\n          callback,\n          null,\n          new Collection(\n            coll.s.db,\n            coll.s.topology,\n            coll.s.namespace.db,\n            newName,\n            coll.s.pkFactory,\n            coll.s.options\n          )\n        );\n      } catch (err) {\n        return handleCallback(callback, toError(err), null);\n      }\n    });\n  }\n}\n\nmodule.exports = RenameOperation;\n"],"names":["require$$0","require$$1","require$$2","require$$3"],"mappings":"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"}