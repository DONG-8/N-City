{"version":3,"file":"replace_one.js","sources":["../../../../../../../node_modules/mongodb/lib/operations/replace_one.js"],"sourcesContent":["'use strict';\n\nconst OperationBase = require('./operation').OperationBase;\nconst updateDocuments = require('./common_functions').updateDocuments;\nconst hasAtomicOperators = require('../utils').hasAtomicOperators;\n\nclass ReplaceOneOperation extends OperationBase {\n  constructor(collection, filter, replacement, options) {\n    super(options);\n\n    if (hasAtomicOperators(replacement)) {\n      throw new TypeError('Replacement document must not contain atomic operators');\n    }\n\n    this.collection = collection;\n    this.filter = filter;\n    this.replacement = replacement;\n  }\n\n  execute(callback) {\n    const coll = this.collection;\n    const filter = this.filter;\n    const replacement = this.replacement;\n    const options = this.options;\n\n    // Set single document update\n    options.multi = false;\n\n    // Execute update\n    updateDocuments(coll, filter, replacement, options, (err, r) =>\n      replaceCallback(err, r, replacement, callback)\n    );\n  }\n}\n\nfunction replaceCallback(err, r, doc, callback) {\n  if (callback == null) return;\n  if (err && callback) return callback(err);\n  if (r == null) return callback(null, { result: { ok: 1 } });\n\n  r.modifiedCount = r.result.nModified != null ? r.result.nModified : r.result.n;\n  r.upsertedId =\n    Array.isArray(r.result.upserted) && r.result.upserted.length > 0\n      ? r.result.upserted[0] // FIXME(major): should be `r.result.upserted[0]._id`\n      : null;\n  r.upsertedCount =\n    Array.isArray(r.result.upserted) && r.result.upserted.length ? r.result.upserted.length : 0;\n  r.matchedCount =\n    Array.isArray(r.result.upserted) && r.result.upserted.length > 0 ? 0 : r.result.n;\n  r.ops = [doc]; // TODO: Should we still have this?\n  if (callback) callback(null, r);\n}\n\nmodule.exports = ReplaceOneOperation;\n"],"names":["require$$0","require$$1","require$$2"],"mappings":"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"}