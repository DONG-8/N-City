{"version":3,"file":"connect.mjs","sources":["../../../../../../../../node_modules/mongodb/lib/core/connection/connect.js"],"sourcesContent":["'use strict';\nconst net = require('net');\nconst tls = require('tls');\nconst Connection = require('./connection');\nconst MongoError = require('../error').MongoError;\nconst MongoNetworkError = require('../error').MongoNetworkError;\nconst MongoNetworkTimeoutError = require('../error').MongoNetworkTimeoutError;\nconst defaultAuthProviders = require('../auth/defaultAuthProviders').defaultAuthProviders;\nconst AuthContext = require('../auth/auth_provider').AuthContext;\nconst WIRE_CONSTANTS = require('../wireprotocol/constants');\nconst makeClientMetadata = require('../utils').makeClientMetadata;\nconst MAX_SUPPORTED_WIRE_VERSION = WIRE_CONSTANTS.MAX_SUPPORTED_WIRE_VERSION;\nconst MAX_SUPPORTED_SERVER_VERSION = WIRE_CONSTANTS.MAX_SUPPORTED_SERVER_VERSION;\nconst MIN_SUPPORTED_WIRE_VERSION = WIRE_CONSTANTS.MIN_SUPPORTED_WIRE_VERSION;\nconst MIN_SUPPORTED_SERVER_VERSION = WIRE_CONSTANTS.MIN_SUPPORTED_SERVER_VERSION;\nlet AUTH_PROVIDERS;\n\nfunction connect(options, cancellationToken, callback) {\n  if (typeof cancellationToken === 'function') {\n    callback = cancellationToken;\n    cancellationToken = undefined;\n  }\n\n  const ConnectionType = options && options.connectionType ? options.connectionType : Connection;\n  if (AUTH_PROVIDERS == null) {\n    AUTH_PROVIDERS = defaultAuthProviders(options.bson);\n  }\n\n  const family = options.family !== void 0 ? options.family : 0;\n  makeConnection(family, options, cancellationToken, (err, socket) => {\n    if (err) {\n      callback(err, socket); // in the error case, `socket` is the originating error event name\n      return;\n    }\n\n    performInitialHandshake(new ConnectionType(socket, options), options, callback);\n  });\n}\n\nfunction isModernConnectionType(conn) {\n  return !(conn instanceof Connection);\n}\n\nfunction checkSupportedServer(ismaster, options) {\n  const serverVersionHighEnough =\n    ismaster &&\n    typeof ismaster.maxWireVersion === 'number' &&\n    ismaster.maxWireVersion >= MIN_SUPPORTED_WIRE_VERSION;\n  const serverVersionLowEnough =\n    ismaster &&\n    typeof ismaster.minWireVersion === 'number' &&\n    ismaster.minWireVersion <= MAX_SUPPORTED_WIRE_VERSION;\n\n  if (serverVersionHighEnough) {\n    if (serverVersionLowEnough) {\n      return null;\n    }\n\n    const message = `Server at ${options.host}:${options.port} reports minimum wire version ${ismaster.minWireVersion}, but this version of the Node.js Driver requires at most ${MAX_SUPPORTED_WIRE_VERSION} (MongoDB ${MAX_SUPPORTED_SERVER_VERSION})`;\n    return new MongoError(message);\n  }\n\n  const message = `Server at ${options.host}:${\n    options.port\n  } reports maximum wire version ${ismaster.maxWireVersion ||\n    0}, but this version of the Node.js Driver requires at least ${MIN_SUPPORTED_WIRE_VERSION} (MongoDB ${MIN_SUPPORTED_SERVER_VERSION})`;\n  return new MongoError(message);\n}\n\nfunction performInitialHandshake(conn, options, _callback) {\n  const callback = function(err, ret) {\n    if (err && conn) {\n      conn.destroy();\n    }\n    _callback(err, ret);\n  };\n\n  const credentials = options.credentials;\n  if (credentials) {\n    if (!credentials.mechanism.match(/DEFAULT/i) && !AUTH_PROVIDERS[credentials.mechanism]) {\n      callback(new MongoError(`authMechanism '${credentials.mechanism}' not supported`));\n      return;\n    }\n  }\n\n  const authContext = new AuthContext(conn, credentials, options);\n  prepareHandshakeDocument(authContext, (err, handshakeDoc) => {\n    if (err) {\n      return callback(err);\n    }\n\n    const handshakeOptions = Object.assign({}, options);\n    if (options.connectTimeoutMS || options.connectionTimeout) {\n      // The handshake technically is a monitoring check, so its socket timeout should be connectTimeoutMS\n      handshakeOptions.socketTimeout = options.connectTimeoutMS || options.connectionTimeout;\n    }\n\n    const start = new Date().getTime();\n    conn.command('admin.$cmd', handshakeDoc, handshakeOptions, (err, result) => {\n      if (err) {\n        callback(err);\n        return;\n      }\n\n      const response = result.result;\n      if (response.ok === 0) {\n        callback(new MongoError(response));\n        return;\n      }\n\n      const supportedServerErr = checkSupportedServer(response, options);\n      if (supportedServerErr) {\n        callback(supportedServerErr);\n        return;\n      }\n\n      if (!isModernConnectionType(conn)) {\n        // resolve compression\n        if (response.compression) {\n          const agreedCompressors = handshakeDoc.compression.filter(\n            compressor => response.compression.indexOf(compressor) !== -1\n          );\n\n          if (agreedCompressors.length) {\n            conn.agreedCompressor = agreedCompressors[0];\n          }\n\n          if (options.compression && options.compression.zlibCompressionLevel) {\n            conn.zlibCompressionLevel = options.compression.zlibCompressionLevel;\n          }\n        }\n      }\n\n      // NOTE: This is metadata attached to the connection while porting away from\n      //       handshake being done in the `Server` class. Likely, it should be\n      //       relocated, or at very least restructured.\n      conn.ismaster = response;\n      conn.lastIsMasterMS = new Date().getTime() - start;\n\n      if (!response.arbiterOnly && credentials) {\n        // store the response on auth context\n        Object.assign(authContext, { response });\n\n        const resolvedCredentials = credentials.resolveAuthMechanism(response);\n        const authProvider = AUTH_PROVIDERS[resolvedCredentials.mechanism];\n        authProvider.auth(authContext, err => {\n          if (err) return callback(err);\n          callback(undefined, conn);\n        });\n\n        return;\n      }\n\n      callback(undefined, conn);\n    });\n  });\n}\n\nfunction prepareHandshakeDocument(authContext, callback) {\n  const options = authContext.options;\n  const compressors =\n    options.compression && options.compression.compressors ? options.compression.compressors : [];\n\n  const handshakeDoc = {\n    ismaster: true,\n    client: options.metadata || makeClientMetadata(options),\n    compression: compressors\n  };\n\n  const credentials = authContext.credentials;\n  if (credentials) {\n    if (credentials.mechanism.match(/DEFAULT/i) && credentials.username) {\n      Object.assign(handshakeDoc, {\n        saslSupportedMechs: `${credentials.source}.${credentials.username}`\n      });\n\n      AUTH_PROVIDERS['scram-sha-256'].prepare(handshakeDoc, authContext, callback);\n      return;\n    }\n\n    const authProvider = AUTH_PROVIDERS[credentials.mechanism];\n    authProvider.prepare(handshakeDoc, authContext, callback);\n    return;\n  }\n\n  callback(undefined, handshakeDoc);\n}\n\nconst LEGAL_SSL_SOCKET_OPTIONS = [\n  'pfx',\n  'key',\n  'passphrase',\n  'cert',\n  'ca',\n  'ciphers',\n  'NPNProtocols',\n  'ALPNProtocols',\n  'servername',\n  'ecdhCurve',\n  'secureProtocol',\n  'secureContext',\n  'session',\n  'minDHSize',\n  'crl',\n  'rejectUnauthorized'\n];\n\nfunction parseConnectOptions(family, options) {\n  const host = typeof options.host === 'string' ? options.host : 'localhost';\n  if (host.indexOf('/') !== -1) {\n    return { path: host };\n  }\n\n  const result = {\n    family,\n    host,\n    port: typeof options.port === 'number' ? options.port : 27017,\n    rejectUnauthorized: false\n  };\n\n  return result;\n}\n\nfunction parseSslOptions(family, options) {\n  const result = parseConnectOptions(family, options);\n\n  // Merge in valid SSL options\n  for (const name in options) {\n    if (options[name] != null && LEGAL_SSL_SOCKET_OPTIONS.indexOf(name) !== -1) {\n      result[name] = options[name];\n    }\n  }\n\n  // Override checkServerIdentity behavior\n  if (options.checkServerIdentity === false) {\n    // Skip the identiy check by retuning undefined as per node documents\n    // https://nodejs.org/api/tls.html#tls_tls_connect_options_callback\n    result.checkServerIdentity = function() {\n      return undefined;\n    };\n  } else if (typeof options.checkServerIdentity === 'function') {\n    result.checkServerIdentity = options.checkServerIdentity;\n  }\n\n  // Set default sni servername to be the same as host\n  if (result.servername == null && !net.isIP(result.host)) {\n    result.servername = result.host;\n  }\n\n  return result;\n}\n\nconst SOCKET_ERROR_EVENTS = new Set(['error', 'close', 'timeout', 'parseError']);\nfunction makeConnection(family, options, cancellationToken, _callback) {\n  const useSsl = typeof options.ssl === 'boolean' ? options.ssl : false;\n  const keepAlive = typeof options.keepAlive === 'boolean' ? options.keepAlive : true;\n  let keepAliveInitialDelay =\n    typeof options.keepAliveInitialDelay === 'number' ? options.keepAliveInitialDelay : 120000;\n  const noDelay = typeof options.noDelay === 'boolean' ? options.noDelay : true;\n  const connectionTimeout =\n    typeof options.connectionTimeout === 'number'\n      ? options.connectionTimeout\n      : typeof options.connectTimeoutMS === 'number'\n      ? options.connectTimeoutMS\n      : 30000;\n  const socketTimeout = typeof options.socketTimeout === 'number' ? options.socketTimeout : 0;\n  const rejectUnauthorized =\n    typeof options.rejectUnauthorized === 'boolean' ? options.rejectUnauthorized : true;\n\n  if (keepAliveInitialDelay > socketTimeout) {\n    keepAliveInitialDelay = Math.round(socketTimeout / 2);\n  }\n\n  let socket;\n  const callback = function(err, ret) {\n    if (err && socket) {\n      socket.destroy();\n    }\n\n    _callback(err, ret);\n  };\n\n  try {\n    if (useSsl) {\n      socket = tls.connect(parseSslOptions(family, options));\n      if (typeof socket.disableRenegotiation === 'function') {\n        socket.disableRenegotiation();\n      }\n    } else {\n      socket = net.createConnection(parseConnectOptions(family, options));\n    }\n  } catch (err) {\n    return callback(err);\n  }\n\n  socket.setKeepAlive(keepAlive, keepAliveInitialDelay);\n  socket.setTimeout(connectionTimeout);\n  socket.setNoDelay(noDelay);\n\n  const connectEvent = useSsl ? 'secureConnect' : 'connect';\n  let cancellationHandler;\n  function errorHandler(eventName) {\n    return err => {\n      SOCKET_ERROR_EVENTS.forEach(event => socket.removeAllListeners(event));\n      if (cancellationHandler) {\n        cancellationToken.removeListener('cancel', cancellationHandler);\n      }\n\n      socket.removeListener(connectEvent, connectHandler);\n      callback(connectionFailureError(eventName, err));\n    };\n  }\n\n  function connectHandler() {\n    SOCKET_ERROR_EVENTS.forEach(event => socket.removeAllListeners(event));\n    if (cancellationHandler) {\n      cancellationToken.removeListener('cancel', cancellationHandler);\n    }\n\n    if (socket.authorizationError && rejectUnauthorized) {\n      return callback(socket.authorizationError);\n    }\n\n    socket.setTimeout(socketTimeout);\n    callback(null, socket);\n  }\n\n  SOCKET_ERROR_EVENTS.forEach(event => socket.once(event, errorHandler(event)));\n  if (cancellationToken) {\n    cancellationHandler = errorHandler('cancel');\n    cancellationToken.once('cancel', cancellationHandler);\n  }\n\n  socket.once(connectEvent, connectHandler);\n}\n\nfunction connectionFailureError(type, err) {\n  switch (type) {\n    case 'error':\n      return new MongoNetworkError(err);\n    case 'timeout':\n      return new MongoNetworkTimeoutError(`connection timed out`);\n    case 'close':\n      return new MongoNetworkError(`connection closed`);\n    case 'cancel':\n      return new MongoNetworkError(`connection establishment was cancelled`);\n    default:\n      return new MongoNetworkError(`unknown network error`);\n  }\n}\n\nmodule.exports = connect;\n"],"names":["require$$0","require$$1","require$$2","require$$3","WIRE_CONSTANTS","Connection"],"mappings":"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"}