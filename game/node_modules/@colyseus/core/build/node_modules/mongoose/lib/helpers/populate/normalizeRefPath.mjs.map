{"version":3,"file":"normalizeRefPath.mjs","sources":["../../../../../../../../node_modules/mongoose/lib/helpers/populate/normalizeRefPath.js"],"sourcesContent":["'use strict';\n\nmodule.exports = function normalizeRefPath(refPath, doc, populatedPath) {\n  if (refPath == null) {\n    return refPath;\n  }\n\n  if (typeof refPath === 'function') {\n    refPath = refPath.call(doc, doc, populatedPath);\n  }\n\n  // If populated path has numerics, the end `refPath` should too. For example,\n  // if populating `a.0.b` instead of `a.b` and `b` has `refPath = a.c`, we\n  // should return `a.0.c` for the refPath.\n  const hasNumericProp = /(\\.\\d+$|\\.\\d+\\.)/g;\n\n  if (hasNumericProp.test(populatedPath)) {\n    const chunks = populatedPath.split(hasNumericProp);\n\n    if (chunks[chunks.length - 1] === '') {\n      throw new Error('Can\\'t populate individual element in an array');\n    }\n\n    let _refPath = '';\n    let _remaining = refPath;\n    // 2nd, 4th, etc. will be numeric props. For example: `[ 'a', '.0.', 'b' ]`\n    for (let i = 0; i < chunks.length; i += 2) {\n      const chunk = chunks[i];\n      if (_remaining.startsWith(chunk + '.')) {\n        _refPath += _remaining.substr(0, chunk.length) + chunks[i + 1];\n        _remaining = _remaining.substr(chunk.length + 1);\n      } else if (i === chunks.length - 1) {\n        _refPath += _remaining;\n        _remaining = '';\n        break;\n      } else {\n        throw new Error('Could not normalize ref path, chunk ' + chunk + ' not in populated path');\n      }\n    }\n\n    return _refPath;\n  }\n\n  return refPath;\n};"],"names":[],"mappings":"oBAEc,GAAG,SAAS,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE,aAAa,EAAE;AACxE,EAAE,IAAI,OAAO,IAAI,IAAI,EAAE;AACvB,IAAI,OAAO,OAAO,CAAC;AACnB,GAAG;AACH;AACA,EAAE,IAAI,OAAO,OAAO,KAAK,UAAU,EAAE;AACrC,IAAI,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,aAAa,CAAC,CAAC;AACpD,GAAG;AACH;AACA;AACA;AACA;AACA,EAAE,MAAM,cAAc,GAAG,mBAAmB,CAAC;AAC7C;AACA,EAAE,IAAI,cAAc,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE;AAC1C,IAAI,MAAM,MAAM,GAAG,aAAa,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;AACvD;AACA,IAAI,IAAI,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE;AAC1C,MAAM,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;AACxE,KAAK;AACL;AACA,IAAI,IAAI,QAAQ,GAAG,EAAE,CAAC;AACtB,IAAI,IAAI,UAAU,GAAG,OAAO,CAAC;AAC7B;AACA,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE;AAC/C,MAAM,MAAM,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;AAC9B,MAAM,IAAI,UAAU,CAAC,UAAU,CAAC,KAAK,GAAG,GAAG,CAAC,EAAE;AAC9C,QAAQ,QAAQ,IAAI,UAAU,CAAC,MAAM,CAAC,CAAC,EAAE,KAAK,CAAC,MAAM,CAAC,GAAG,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;AACvE,QAAQ,UAAU,GAAG,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;AACzD,OAAO,MAAM,IAAI,CAAC,KAAK,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;AAC1C,QAAQ,QAAQ,IAAI,UAAU,CAAC;AAC/B,QAAQ,UAAU,GAAG,EAAE,CAAC;AACxB,QAAQ,MAAM;AACd,OAAO,MAAM;AACb,QAAQ,MAAM,IAAI,KAAK,CAAC,sCAAsC,GAAG,KAAK,GAAG,wBAAwB,CAAC,CAAC;AACnG,OAAO;AACP,KAAK;AACL;AACA,IAAI,OAAO,QAAQ,CAAC;AACpB,GAAG;AACH;AACA,EAAE,OAAO,OAAO,CAAC;AACjB;;;;"}