{"version":3,"file":"stringifyFunctionOperators.js","sources":["../../../../../../../../node_modules/mongoose/lib/helpers/aggregate/stringifyFunctionOperators.js"],"sourcesContent":["'use strict';\n\nmodule.exports = function stringifyFunctionOperators(pipeline) {\n  if (!Array.isArray(pipeline)) {\n    return;\n  }\n\n  for (const stage of pipeline) {\n    if (stage == null) {\n      continue;\n    }\n\n    const canHaveAccumulator = stage.$group || stage.$bucket || stage.$bucketAuto;\n    if (canHaveAccumulator != null) {\n      for (const key of Object.keys(canHaveAccumulator)) {\n        handleAccumulator(canHaveAccumulator[key]);\n      }\n    }\n\n    const stageType = Object.keys(stage)[0];\n    if (stageType && typeof stage[stageType] === 'object') {\n      const stageOptions = stage[stageType];\n      for (const key of Object.keys(stageOptions)) {\n        if (stageOptions[key] != null &&\n            stageOptions[key].$function != null &&\n            typeof stageOptions[key].$function.body === 'function') {\n          stageOptions[key].$function.body = stageOptions[key].$function.body.toString();\n        }\n      }\n    }\n\n    if (stage.$facet != null) {\n      for (const key of Object.keys(stage.$facet)) {\n        stringifyFunctionOperators(stage.$facet[key]);\n      }\n    }\n  }\n};\n\nfunction handleAccumulator(operator) {\n  if (operator == null || operator.$accumulator == null) {\n    return;\n  }\n\n  for (const key of ['init', 'accumulate', 'merge', 'finalize']) {\n    if (typeof operator.$accumulator[key] === 'function') {\n      operator.$accumulator[key] = String(operator.$accumulator[key]);\n    }\n  }\n}"],"names":[],"mappings":";;8BAEc,GAAG,SAAS,0BAA0B,CAAC,QAAQ,EAAE;AAC/D,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;AAChC,IAAI,OAAO;AACX,GAAG;AACH;AACA,EAAE,KAAK,MAAM,KAAK,IAAI,QAAQ,EAAE;AAChC,IAAI,IAAI,KAAK,IAAI,IAAI,EAAE;AACvB,MAAM,SAAS;AACf,KAAK;AACL;AACA,IAAI,MAAM,kBAAkB,GAAG,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,WAAW,CAAC;AAClF,IAAI,IAAI,kBAAkB,IAAI,IAAI,EAAE;AACpC,MAAM,KAAK,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAE;AACzD,QAAQ,iBAAiB,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,CAAC;AACnD,OAAO;AACP,KAAK;AACL;AACA,IAAI,MAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5C,IAAI,IAAI,SAAS,IAAI,OAAO,KAAK,CAAC,SAAS,CAAC,KAAK,QAAQ,EAAE;AAC3D,MAAM,MAAM,YAAY,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC;AAC5C,MAAM,KAAK,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE;AACnD,QAAQ,IAAI,YAAY,CAAC,GAAG,CAAC,IAAI,IAAI;AACrC,YAAY,YAAY,CAAC,GAAG,CAAC,CAAC,SAAS,IAAI,IAAI;AAC/C,YAAY,OAAO,YAAY,CAAC,GAAG,CAAC,CAAC,SAAS,CAAC,IAAI,KAAK,UAAU,EAAE;AACpE,UAAU,YAAY,CAAC,GAAG,CAAC,CAAC,SAAS,CAAC,IAAI,GAAG,YAAY,CAAC,GAAG,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;AACzF,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA,IAAI,IAAI,KAAK,CAAC,MAAM,IAAI,IAAI,EAAE;AAC9B,MAAM,KAAK,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE;AACnD,QAAQ,0BAA0B,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;AACtD,OAAO;AACP,KAAK;AACL,GAAG;AACH,EAAE;AACF;AACA,SAAS,iBAAiB,CAAC,QAAQ,EAAE;AACrC,EAAE,IAAI,QAAQ,IAAI,IAAI,IAAI,QAAQ,CAAC,YAAY,IAAI,IAAI,EAAE;AACzD,IAAI,OAAO;AACX,GAAG;AACH;AACA,EAAE,KAAK,MAAM,GAAG,IAAI,CAAC,MAAM,EAAE,YAAY,EAAE,OAAO,EAAE,UAAU,CAAC,EAAE;AACjE,IAAI,IAAI,OAAO,QAAQ,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,UAAU,EAAE;AAC1D,MAAM,QAAQ,CAAC,YAAY,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,QAAQ,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC;AACtE,KAAK;AACL,GAAG;AACH;;;;"}