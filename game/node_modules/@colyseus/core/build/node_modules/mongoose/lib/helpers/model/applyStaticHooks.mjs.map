{"version":3,"file":"applyStaticHooks.mjs","sources":["../../../../../../../../node_modules/mongoose/lib/helpers/model/applyStaticHooks.js"],"sourcesContent":["'use strict';\n\nconst middlewareFunctions = require('../query/applyQueryMiddleware').middlewareFunctions;\nconst promiseOrCallback = require('../promiseOrCallback');\n\nmodule.exports = function applyStaticHooks(model, hooks, statics) {\n  const kareemOptions = {\n    useErrorHandlers: true,\n    numCallbackParams: 1\n  };\n\n  hooks = hooks.filter(hook => {\n    // If the custom static overwrites an existing query middleware, don't apply\n    // middleware to it by default. This avoids a potential backwards breaking\n    // change with plugins like `mongoose-delete` that use statics to overwrite\n    // built-in Mongoose functions.\n    if (middlewareFunctions.indexOf(hook.name) !== -1) {\n      return !!hook.model;\n    }\n    return hook.model !== false;\n  });\n\n  model.$__insertMany = hooks.createWrapper('insertMany',\n    model.$__insertMany, model, kareemOptions);\n\n  for (const key of Object.keys(statics)) {\n    if (hooks.hasHooks(key)) {\n      const original = model[key];\n\n      model[key] = function() {\n        const numArgs = arguments.length;\n        const lastArg = numArgs > 0 ? arguments[numArgs - 1] : null;\n        const cb = typeof lastArg === 'function' ? lastArg : null;\n        const args = Array.prototype.slice.\n          call(arguments, 0, cb == null ? numArgs : numArgs - 1);\n        // Special case: can't use `Kareem#wrap()` because it doesn't currently\n        // support wrapped functions that return a promise.\n        return promiseOrCallback(cb, callback => {\n          hooks.execPre(key, model, args, function(err) {\n            if (err != null) {\n              return callback(err);\n            }\n\n            let postCalled = 0;\n            const ret = original.apply(model, args.concat(post));\n            if (ret != null && typeof ret.then === 'function') {\n              ret.then(res => post(null, res), err => post(err));\n            }\n\n            function post(error, res) {\n              if (postCalled++ > 0) {\n                return;\n              }\n\n              if (error != null) {\n                return callback(error);\n              }\n\n              hooks.execPost(key, model, [res], function(error) {\n                if (error != null) {\n                  return callback(error);\n                }\n                callback(null, res);\n              });\n            }\n          });\n        }, model.events);\n      };\n    }\n  }\n};"],"names":["require$$0"],"mappings":"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"}