{"version":3,"file":"clone.mjs","sources":["../../../../../../../node_modules/mongoose/lib/helpers/clone.js"],"sourcesContent":["'use strict';\n\n\nconst cloneRegExp = require('regexp-clone');\nconst Decimal = require('../types/decimal128');\nconst ObjectId = require('../types/objectid');\nconst specialProperties = require('./specialProperties');\nconst isMongooseObject = require('./isMongooseObject');\nconst getFunctionName = require('./getFunctionName');\nconst isBsonType = require('./isBsonType');\nconst isObject = require('./isObject');\nconst symbols = require('./symbols');\nconst utils = require('../utils');\n\n\n/*!\n * Object clone with Mongoose natives support.\n *\n * If options.minimize is true, creates a minimal data object. Empty objects and undefined values will not be cloned. This makes the data payload sent to MongoDB as small as possible.\n *\n * Functions are never cloned.\n *\n * @param {Object} obj the object to clone\n * @param {Object} options\n * @param {Boolean} isArrayChild true if cloning immediately underneath an array. Special case for minimize.\n * @return {Object} the cloned object\n * @api private\n */\n\nfunction clone(obj, options, isArrayChild) {\n  if (obj == null) {\n    return obj;\n  }\n\n  if (Array.isArray(obj)) {\n    return cloneArray(obj, options);\n  }\n\n  if (isMongooseObject(obj)) {\n    // Single nested subdocs should apply getters later in `applyGetters()`\n    // when calling `toObject()`. See gh-7442, gh-8295\n    if (options && options._skipSingleNestedGetters && obj.$isSingleNested) {\n      options = Object.assign({}, options, { getters: false });\n    }\n\n    if (utils.isPOJO(obj) && obj.$__ != null && obj._doc != null) {\n      return obj._doc;\n    }\n\n    if (options && options.json && typeof obj.toJSON === 'function') {\n      return obj.toJSON(options);\n    }\n    return obj.toObject(options);\n  }\n\n  if (obj.constructor) {\n    switch (getFunctionName(obj.constructor)) {\n      case 'Object':\n        return cloneObject(obj, options, isArrayChild);\n      case 'Date':\n        return new obj.constructor(+obj);\n      case 'RegExp':\n        return cloneRegExp(obj);\n      default:\n        // ignore\n        break;\n    }\n  }\n\n  if (obj instanceof ObjectId) {\n    return new ObjectId(obj.id);\n  }\n\n  if (isBsonType(obj, 'Decimal128')) {\n    if (options && options.flattenDecimals) {\n      return obj.toJSON();\n    }\n    return Decimal.fromString(obj.toString());\n  }\n\n  if (!obj.constructor && isObject(obj)) {\n    // object created with Object.create(null)\n    return cloneObject(obj, options, isArrayChild);\n  }\n\n  if (obj[symbols.schemaTypeSymbol]) {\n    return obj.clone();\n  }\n\n  // If we're cloning this object to go into a MongoDB command,\n  // and there's a `toBSON()` function, assume this object will be\n  // stored as a primitive in MongoDB and doesn't need to be cloned.\n  if (options && options.bson && typeof obj.toBSON === 'function') {\n    return obj;\n  }\n\n  if (obj.valueOf != null) {\n    return obj.valueOf();\n  }\n\n  return cloneObject(obj, options, isArrayChild);\n}\nmodule.exports = clone;\n\n/*!\n * ignore\n */\n\nfunction cloneObject(obj, options, isArrayChild) {\n  const minimize = options && options.minimize;\n  const ret = {};\n  let hasKeys;\n\n  for (const k of Object.keys(obj)) {\n    if (specialProperties.has(k)) {\n      continue;\n    }\n\n    // Don't pass `isArrayChild` down\n    const val = clone(obj[k], options);\n\n    if (!minimize || (typeof val !== 'undefined')) {\n      if (minimize === false && typeof val === 'undefined') {\n        delete ret[k];\n      } else {\n        hasKeys || (hasKeys = true);\n        ret[k] = val;\n      }\n    }\n  }\n\n  return minimize && !isArrayChild ? hasKeys && ret : ret;\n}\n\nfunction cloneArray(arr, options) {\n  const ret = [];\n\n  for (const item of arr) {\n    ret.push(clone(item, options, true));\n  }\n\n  return ret;\n}"],"names":["cloneRegExp","ObjectId","isBsonType","Decimal"],"mappings":"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"}