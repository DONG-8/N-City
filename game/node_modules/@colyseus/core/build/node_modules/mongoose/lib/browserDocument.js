'use strict';

var _commonjsHelpers = require('../../../_virtual/_commonjsHelpers.js');
var document = require('./document.js');
var require$$0 = require('events');
var index = require('./error/index.js');
var schema = require('./schema.js');
var objectid = require('./types/objectid.js');
var applyHooks = require('./helpers/model/applyHooks.js');
var isObject = require('./helpers/isObject.js');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var require$$0__default = /*#__PURE__*/_interopDefaultLegacy(require$$0);

/*!
 * Module dependencies.
 */

var browserDocument = _commonjsHelpers.createCommonjsModule(function (module, exports) {


const EventEmitter = require$$0__default['default'].EventEmitter;



const ValidationError = index.ValidationError;



/**
 * Document constructor.
 *
 * @param {Object} obj the values to set
 * @param {Object} [fields] optional object containing the fields which were selected in the query returning this document and any populated paths data
 * @param {Boolean} [skipId] bool, should we auto create an ObjectId _id
 * @inherits NodeJS EventEmitter http://nodejs.org/api/events.html#events_class_events_eventemitter
 * @event `init`: Emitted on a document after it has was retrieved from the db and fully hydrated by Mongoose.
 * @event `save`: Emitted when the document is successfully saved
 * @api private
 */

function Document(obj, schema$1, fields, skipId, skipInit) {
  if (!(this instanceof Document)) {
    return new Document(obj, schema$1, fields, skipId, skipInit);
  }

  if (isObject(schema$1) && !schema$1.instanceOfSchema) {
    schema$1 = new schema(schema$1);
  }

  // When creating EmbeddedDocument, it already has the schema and he doesn't need the _id
  schema$1 = this.schema || schema$1;

  // Generate ObjectId if it is missing, but it requires a scheme
  if (!this.schema && schema$1.options._id) {
    obj = obj || {};

    if (obj._id === undefined) {
      obj._id = new objectid();
    }
  }

  if (!schema$1) {
    throw new index.MissingSchemaError();
  }

  this.$__setSchema(schema$1);

  document.call(this, obj, fields, skipId, skipInit);

  applyHooks(this, schema$1, { decorateDoc: true });

  // apply methods
  for (const m in schema$1.methods) {
    this[m] = schema$1.methods[m];
  }
  // apply statics
  for (const s in schema$1.statics) {
    this[s] = schema$1.statics[s];
  }
}

/*!
 * Inherit from the NodeJS document
 */

Document.prototype = Object.create(document.prototype);
Document.prototype.constructor = Document;

/*!
 * ignore
 */

Document.events = new EventEmitter();

/*!
 * Browser doc exposes the event emitter API
 */

Document.$emitter = new EventEmitter();

['on', 'once', 'emit', 'listeners', 'removeListener', 'setMaxListeners',
  'removeAllListeners', 'addListener'].forEach(function(emitterFn) {
  Document[emitterFn] = function() {
    return Document.$emitter[emitterFn].apply(Document.$emitter, arguments);
  };
});

/*!
 * Module exports.
 */

Document.ValidationError = ValidationError;
module.exports = Document;
});

module.exports = browserDocument;
//# sourceMappingURL=browserDocument.js.map
