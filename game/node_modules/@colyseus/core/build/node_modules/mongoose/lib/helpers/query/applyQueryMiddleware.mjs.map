{"version":3,"file":"applyQueryMiddleware.mjs","sources":["../../../../../../../../node_modules/mongoose/lib/helpers/query/applyQueryMiddleware.js"],"sourcesContent":["'use strict';\n\n/*!\n * ignore\n */\n\nmodule.exports = applyQueryMiddleware;\n\n/*!\n * ignore\n */\n\napplyQueryMiddleware.middlewareFunctions = [\n  'count',\n  'countDocuments',\n  'deleteMany',\n  'deleteOne',\n  'distinct',\n  'estimatedDocumentCount',\n  'find',\n  'findOne',\n  'findOneAndDelete',\n  'findOneAndRemove',\n  'findOneAndReplace',\n  'findOneAndUpdate',\n  'remove',\n  'replaceOne',\n  'update',\n  'updateMany',\n  'updateOne',\n  'validate'\n];\n\n/*!\n * Apply query middleware\n *\n * @param {Query} query constructor\n * @param {Model} model\n */\n\nfunction applyQueryMiddleware(Query, model) {\n  const kareemOptions = {\n    useErrorHandlers: true,\n    numCallbackParams: 1,\n    nullResultByDefault: true\n  };\n\n  const middleware = model.hooks.filter(hook => {\n    const contexts = _getContexts(hook);\n    if (hook.name === 'updateOne') {\n      return contexts.query == null || !!contexts.query;\n    }\n    if (hook.name === 'deleteOne') {\n      return !!contexts.query || Object.keys(contexts).length === 0;\n    }\n    if (hook.name === 'validate' || hook.name === 'remove') {\n      return !!contexts.query;\n    }\n    if (hook.query != null || hook.document != null) {\n      return !!hook.query;\n    }\n    return true;\n  });\n\n  // `update()` thunk has a different name because `_update` was already taken\n  Query.prototype._execUpdate = middleware.createWrapper('update',\n    Query.prototype._execUpdate, null, kareemOptions);\n  // `distinct()` thunk has a different name because `_distinct` was already taken\n  Query.prototype.__distinct = middleware.createWrapper('distinct',\n    Query.prototype.__distinct, null, kareemOptions);\n\n  // `validate()` doesn't have a thunk because it doesn't execute a query.\n  Query.prototype.validate = middleware.createWrapper('validate',\n    Query.prototype.validate, null, kareemOptions);\n\n  applyQueryMiddleware.middlewareFunctions.\n    filter(v => v !== 'update' && v !== 'distinct' && v !== 'validate').\n    forEach(fn => {\n      Query.prototype[`_${fn}`] = middleware.createWrapper(fn,\n        Query.prototype[`_${fn}`], null, kareemOptions);\n    });\n}\n\nfunction _getContexts(hook) {\n  const ret = {};\n  if (hook.hasOwnProperty('query')) {\n    ret.query = hook.query;\n  }\n  if (hook.hasOwnProperty('document')) {\n    ret.document = hook.document;\n  }\n  return ret;\n}"],"names":[],"mappings":"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"}