{"version":3,"file":"array.js","sources":["../../../../../../../node_modules/mongoose/lib/types/array.js"],"sourcesContent":["/*!\n * Module dependencies.\n */\n\n'use strict';\n\nconst CoreMongooseArray = require('./core_array');\n\nconst arrayAtomicsSymbol = require('../helpers/symbols').arrayAtomicsSymbol;\nconst arrayParentSymbol = require('../helpers/symbols').arrayParentSymbol;\nconst arrayPathSymbol = require('../helpers/symbols').arrayPathSymbol;\nconst arraySchemaSymbol = require('../helpers/symbols').arraySchemaSymbol;\n\nconst _basePush = Array.prototype.push;\n\n/**\n * Mongoose Array constructor.\n *\n * ####NOTE:\n *\n * _Values always have to be passed to the constructor to initialize, otherwise `MongooseArray#push` will mark the array as modified._\n *\n * @param {Array} values\n * @param {String} path\n * @param {Document} doc parent document\n * @api private\n * @inherits Array\n * @see http://bit.ly/f6CnZU\n */\n\nfunction MongooseArray(values, path, doc, schematype) {\n  let arr;\n\n  if (Array.isArray(values)) {\n    const len = values.length;\n\n    // Perf optimizations for small arrays: much faster to use `...` than `for` + `push`,\n    // but large arrays may cause stack overflows. And for arrays of length 0/1, just\n    // modifying the array is faster. Seems small, but adds up when you have a document\n    // with thousands of nested arrays.\n    if (len === 0) {\n      arr = new CoreMongooseArray();\n    } else if (len === 1) {\n      arr = new CoreMongooseArray(1);\n      arr[0] = values[0];\n    } else if (len < 10000) {\n      arr = new CoreMongooseArray();\n      _basePush.apply(arr, values);\n    } else {\n      arr = new CoreMongooseArray();\n      for (let i = 0; i < len; ++i) {\n        _basePush.call(arr, values[i]);\n      }\n    }\n\n    if (values[arrayAtomicsSymbol] != null) {\n      arr[arrayAtomicsSymbol] = values[arrayAtomicsSymbol];\n    }\n  } else {\n    arr = new CoreMongooseArray();\n  }\n\n  arr[arrayPathSymbol] = path;\n\n  // Because doc comes from the context of another function, doc === global\n  // can happen if there was a null somewhere up the chain (see #3020)\n  // RB Jun 17, 2015 updated to check for presence of expected paths instead\n  // to make more proof against unusual node environments\n  if (doc != null && doc.$__ != null) {\n    arr[arrayParentSymbol] = doc;\n    arr[arraySchemaSymbol] = schematype || doc.schema.path(path);\n  }\n\n  return arr;\n}\n\n/*!\n * Module exports.\n */\n\nmodule.exports = exports = MongooseArray;\n"],"names":["require$$0","CoreMongooseArray"],"mappings":";;;;;;;;;;;AAKA;AACkD;AAClD;AACA,MAAM,kBAAkB,GAAGA,kBAA6B,CAAC,kBAAkB,CAAC;AAC5E,MAAM,iBAAiB,GAAGA,kBAA6B,CAAC,iBAAiB,CAAC;AAC1E,MAAM,eAAe,GAAGA,kBAA6B,CAAC,eAAe,CAAC;AACtE,MAAM,iBAAiB,GAAGA,kBAA6B,CAAC,iBAAiB,CAAC;AAC1E;AACA,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,aAAa,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,UAAU,EAAE;AACtD,EAAE,IAAI,GAAG,CAAC;AACV;AACA,EAAE,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;AAC7B,IAAI,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC;AAC9B;AACA;AACA;AACA;AACA;AACA,IAAI,IAAI,GAAG,KAAK,CAAC,EAAE;AACnB,MAAM,GAAG,GAAG,IAAIC,UAAiB,EAAE,CAAC;AACpC,KAAK,MAAM,IAAI,GAAG,KAAK,CAAC,EAAE;AAC1B,MAAM,GAAG,GAAG,IAAIA,UAAiB,CAAC,CAAC,CAAC,CAAC;AACrC,MAAM,GAAG,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;AACzB,KAAK,MAAM,IAAI,GAAG,GAAG,KAAK,EAAE;AAC5B,MAAM,GAAG,GAAG,IAAIA,UAAiB,EAAE,CAAC;AACpC,MAAM,SAAS,CAAC,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;AACnC,KAAK,MAAM;AACX,MAAM,GAAG,GAAG,IAAIA,UAAiB,EAAE,CAAC;AACpC,MAAM,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,EAAE,CAAC,EAAE;AACpC,QAAQ,SAAS,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;AACvC,OAAO;AACP,KAAK;AACL;AACA,IAAI,IAAI,MAAM,CAAC,kBAAkB,CAAC,IAAI,IAAI,EAAE;AAC5C,MAAM,GAAG,CAAC,kBAAkB,CAAC,GAAG,MAAM,CAAC,kBAAkB,CAAC,CAAC;AAC3D,KAAK;AACL,GAAG,MAAM;AACT,IAAI,GAAG,GAAG,IAAIA,UAAiB,EAAE,CAAC;AAClC,GAAG;AACH;AACA,EAAE,GAAG,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC;AAC9B;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,CAAC,GAAG,IAAI,IAAI,EAAE;AACtC,IAAI,GAAG,CAAC,iBAAiB,CAAC,GAAG,GAAG,CAAC;AACjC,IAAI,GAAG,CAAC,iBAAiB,CAAC,GAAG,UAAU,IAAI,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACjE,GAAG;AACH;AACA,EAAE,OAAO,GAAG,CAAC;AACb,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,iBAA2B,aAAa;;;;;"}