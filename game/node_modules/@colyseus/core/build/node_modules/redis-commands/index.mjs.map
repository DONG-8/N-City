{"version":3,"file":"index.mjs","sources":["../../../../../node_modules/redis-commands/index.js"],"sourcesContent":["'use strict'\n\nvar commands = require('./commands.json')\n\n/**\n * Redis command list\n *\n * All commands are lowercased.\n *\n * @var {string[]}\n * @public\n */\nexports.list = Object.keys(commands)\n\nvar flags = {}\nexports.list.forEach(function (commandName) {\n  flags[commandName] = commands[commandName].flags.reduce(function (flags, flag) {\n    flags[flag] = true\n    return flags\n  }, {})\n})\n/**\n * Check if the command exists\n *\n * @param {string} commandName - the command name\n * @return {boolean} result\n * @public\n */\nexports.exists = function (commandName) {\n  return Boolean(commands[commandName])\n}\n\n/**\n * Check if the command has the flag\n *\n * Some of possible flags: readonly, noscript, loading\n * @param {string} commandName - the command name\n * @param {string} flag - the flag to check\n * @return {boolean} result\n * @public\n */\nexports.hasFlag = function (commandName, flag) {\n  if (!flags[commandName]) {\n    throw new Error('Unknown command ' + commandName)\n  }\n\n  return Boolean(flags[commandName][flag])\n}\n\n/**\n * Get indexes of keys in the command arguments\n *\n * @param {string} commandName - the command name\n * @param {string[]} args - the arguments of the command\n * @param {object} [options] - options\n * @param {boolean} [options.parseExternalKey] - parse external keys\n * @return {number[]} - the list of the index\n * @public\n *\n * @example\n * ```javascript\n * getKeyIndexes('set', ['key', 'value']) // [0]\n * getKeyIndexes('mget', ['key1', 'key2']) // [0, 1]\n * ```\n */\nexports.getKeyIndexes = function (commandName, args, options) {\n  var command = commands[commandName]\n  if (!command) {\n    throw new Error('Unknown command ' + commandName)\n  }\n\n  if (!Array.isArray(args)) {\n    throw new Error('Expect args to be an array')\n  }\n\n  var keys = []\n  var i, keyStart, keyStop, parseExternalKey\n  switch (commandName) {\n    case 'zunionstore':\n    case 'zinterstore':\n      keys.push(0)\n    // fall through\n    case 'eval':\n    case 'evalsha':\n      keyStop = Number(args[1]) + 2\n      for (i = 2; i < keyStop; i++) {\n        keys.push(i)\n      }\n      break\n    case 'sort':\n      parseExternalKey = options && options.parseExternalKey\n      keys.push(0)\n      for (i = 1; i < args.length - 1; i++) {\n        if (typeof args[i] !== 'string') {\n          continue\n        }\n        var directive = args[i].toUpperCase()\n        if (directive === 'GET') {\n          i += 1\n          if (args[i] !== '#') {\n            if (parseExternalKey) {\n              keys.push([i, getExternalKeyNameLength(args[i])])\n            } else {\n              keys.push(i)\n            }\n          }\n        } else if (directive === 'BY') {\n          i += 1\n          if (parseExternalKey) {\n            keys.push([i, getExternalKeyNameLength(args[i])])\n          } else {\n            keys.push(i)\n          }\n        } else if (directive === 'STORE') {\n          i += 1\n          keys.push(i)\n        }\n      }\n      break\n    case 'migrate':\n      if (args[2] === '') {\n        for (i = 5; i < args.length - 1; i++) {\n          if (args[i].toUpperCase() === 'KEYS') {\n            for (var j = i + 1; j < args.length; j++) {\n              keys.push(j)\n            }\n            break\n          }\n        }\n      } else {\n        keys.push(2)\n      }\n      break\n    case 'xreadgroup':\n    case 'xread':\n      // Keys are 1st half of the args after STREAMS argument.\n      for (i = commandName === 'xread' ? 0 : 3; i < args.length - 1; i++) {\n        if (String(args[i]).toUpperCase() === 'STREAMS') {\n          for (j = i + 1; j <= i + ((args.length - 1 - i) / 2); j++) {\n            keys.push(j)\n          }\n          break\n        }\n      }\n      break\n    default:\n      // Step has to be at least one in this case, otherwise the command does\n      // not contain a key.\n      if (command.step > 0) {\n        keyStart = command.keyStart - 1\n        keyStop = command.keyStop > 0 ? command.keyStop : args.length + command.keyStop + 1\n        for (i = keyStart; i < keyStop; i += command.step) {\n          keys.push(i)\n        }\n      }\n      break\n  }\n\n  return keys\n}\n\nfunction getExternalKeyNameLength (key) {\n  if (typeof key !== 'string') {\n    key = String(key)\n  }\n  var hashPos = key.indexOf('->')\n  return hashPos === -1 ? key.length : hashPos\n}\n"],"names":[],"mappings":"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"}