{"version":3,"file":"finally.js","sources":["../../../../../../../node_modules/bluebird/js/release/finally.js"],"sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, tryConvertToPromise, NEXT_FILTER) {\nvar util = require(\"./util\");\nvar CancellationError = Promise.CancellationError;\nvar errorObj = util.errorObj;\nvar catchFilter = require(\"./catch_filter\")(NEXT_FILTER);\n\nfunction PassThroughHandlerContext(promise, type, handler) {\n    this.promise = promise;\n    this.type = type;\n    this.handler = handler;\n    this.called = false;\n    this.cancelPromise = null;\n}\n\nPassThroughHandlerContext.prototype.isFinallyHandler = function() {\n    return this.type === 0;\n};\n\nfunction FinallyHandlerCancelReaction(finallyHandler) {\n    this.finallyHandler = finallyHandler;\n}\n\nFinallyHandlerCancelReaction.prototype._resultCancelled = function() {\n    checkCancel(this.finallyHandler);\n};\n\nfunction checkCancel(ctx, reason) {\n    if (ctx.cancelPromise != null) {\n        if (arguments.length > 1) {\n            ctx.cancelPromise._reject(reason);\n        } else {\n            ctx.cancelPromise._cancel();\n        }\n        ctx.cancelPromise = null;\n        return true;\n    }\n    return false;\n}\n\nfunction succeed() {\n    return finallyHandler.call(this, this.promise._target()._settledValue());\n}\nfunction fail(reason) {\n    if (checkCancel(this, reason)) return;\n    errorObj.e = reason;\n    return errorObj;\n}\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    if (!this.called) {\n        this.called = true;\n        var ret = this.isFinallyHandler()\n            ? handler.call(promise._boundValue())\n            : handler.call(promise._boundValue(), reasonOrValue);\n        if (ret === NEXT_FILTER) {\n            return ret;\n        } else if (ret !== undefined) {\n            promise._setReturnedNonUndefined();\n            var maybePromise = tryConvertToPromise(ret, promise);\n            if (maybePromise instanceof Promise) {\n                if (this.cancelPromise != null) {\n                    if (maybePromise._isCancelled()) {\n                        var reason =\n                            new CancellationError(\"late cancellation observer\");\n                        promise._attachExtraTrace(reason);\n                        errorObj.e = reason;\n                        return errorObj;\n                    } else if (maybePromise.isPending()) {\n                        maybePromise._attachCancellationCallback(\n                            new FinallyHandlerCancelReaction(this));\n                    }\n                }\n                return maybePromise._then(\n                    succeed, fail, undefined, this, undefined);\n            }\n        }\n    }\n\n    if (promise.isRejected()) {\n        checkCancel(this);\n        errorObj.e = reasonOrValue;\n        return errorObj;\n    } else {\n        checkCancel(this);\n        return reasonOrValue;\n    }\n}\n\nPromise.prototype._passThrough = function(handler, type, success, fail) {\n    if (typeof handler !== \"function\") return this.then();\n    return this._then(success,\n                      fail,\n                      undefined,\n                      new PassThroughHandlerContext(this, type, handler),\n                      undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThrough(handler,\n                             0,\n                             finallyHandler,\n                             finallyHandler);\n};\n\n\nPromise.prototype.tap = function (handler) {\n    return this._passThrough(handler, 1, finallyHandler);\n};\n\nPromise.prototype.tapCatch = function (handlerOrPredicate) {\n    var len = arguments.length;\n    if(len === 1) {\n        return this._passThrough(handlerOrPredicate,\n                                 1,\n                                 undefined,\n                                 finallyHandler);\n    } else {\n         var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (util.isObject(item)) {\n                catchInstances[j++] = item;\n            } else {\n                return Promise.reject(new TypeError(\n                    \"tapCatch statement predicate: \"\n                    + \"expecting an object but got \" + util.classString(item)\n                ));\n            }\n        }\n        catchInstances.length = j;\n        var handler = arguments[i];\n        return this._passThrough(catchFilter(catchInstances, handler, this),\n                                 1,\n                                 undefined,\n                                 finallyHandler);\n    }\n\n};\n\nreturn PassThroughHandlerContext;\n};\n"],"names":["util","require$$0","require$$1"],"mappings":"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"}