{"version":3,"file":"cancel.mjs","sources":["../../../../../../../node_modules/bluebird/js/release/cancel.js"],"sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, PromiseArray, apiRejection, debug) {\nvar util = require(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nPromise.prototype[\"break\"] = Promise.prototype.cancel = function() {\n    if (!debug.cancellation()) return this._warn(\"cancellation is disabled\");\n\n    var promise = this;\n    var child = promise;\n    while (promise._isCancellable()) {\n        if (!promise._cancelBy(child)) {\n            if (child._isFollowing()) {\n                child._followee().cancel();\n            } else {\n                child._cancelBranched();\n            }\n            break;\n        }\n\n        var parent = promise._cancellationParent;\n        if (parent == null || !parent._isCancellable()) {\n            if (promise._isFollowing()) {\n                promise._followee().cancel();\n            } else {\n                promise._cancelBranched();\n            }\n            break;\n        } else {\n            if (promise._isFollowing()) promise._followee().cancel();\n            promise._setWillBeCancelled();\n            child = promise;\n            promise = parent;\n        }\n    }\n};\n\nPromise.prototype._branchHasCancelled = function() {\n    this._branchesRemainingToCancel--;\n};\n\nPromise.prototype._enoughBranchesHaveCancelled = function() {\n    return this._branchesRemainingToCancel === undefined ||\n           this._branchesRemainingToCancel <= 0;\n};\n\nPromise.prototype._cancelBy = function(canceller) {\n    if (canceller === this) {\n        this._branchesRemainingToCancel = 0;\n        this._invokeOnCancel();\n        return true;\n    } else {\n        this._branchHasCancelled();\n        if (this._enoughBranchesHaveCancelled()) {\n            this._invokeOnCancel();\n            return true;\n        }\n    }\n    return false;\n};\n\nPromise.prototype._cancelBranched = function() {\n    if (this._enoughBranchesHaveCancelled()) {\n        this._cancel();\n    }\n};\n\nPromise.prototype._cancel = function() {\n    if (!this._isCancellable()) return;\n    this._setCancelled();\n    async.invoke(this._cancelPromises, this, undefined);\n};\n\nPromise.prototype._cancelPromises = function() {\n    if (this._length() > 0) this._settlePromises();\n};\n\nPromise.prototype._unsetOnCancel = function() {\n    this._onCancelField = undefined;\n};\n\nPromise.prototype._isCancellable = function() {\n    return this.isPending() && !this._isCancelled();\n};\n\nPromise.prototype.isCancellable = function() {\n    return this.isPending() && !this.isCancelled();\n};\n\nPromise.prototype._doInvokeOnCancel = function(onCancelCallback, internalOnly) {\n    if (util.isArray(onCancelCallback)) {\n        for (var i = 0; i < onCancelCallback.length; ++i) {\n            this._doInvokeOnCancel(onCancelCallback[i], internalOnly);\n        }\n    } else if (onCancelCallback !== undefined) {\n        if (typeof onCancelCallback === \"function\") {\n            if (!internalOnly) {\n                var e = tryCatch(onCancelCallback).call(this._boundValue());\n                if (e === errorObj) {\n                    this._attachExtraTrace(e.e);\n                    async.throwLater(e.e);\n                }\n            }\n        } else {\n            onCancelCallback._resultCancelled(this);\n        }\n    }\n};\n\nPromise.prototype._invokeOnCancel = function() {\n    var onCancelCallback = this._onCancel();\n    this._unsetOnCancel();\n    async.invoke(this._doInvokeOnCancel, this, onCancelCallback);\n};\n\nPromise.prototype._invokeInternalOnCancel = function() {\n    if (this._isCancellable()) {\n        this._doInvokeOnCancel(this._onCancel(), true);\n        this._unsetOnCancel();\n    }\n};\n\nPromise.prototype._resultCancelled = function() {\n    this.cancel();\n};\n\n};\n"],"names":["util","require$$0"],"mappings":"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"}