{"version":3,"file":"reduce.js","sources":["../../../../../../../node_modules/bluebird/js/release/reduce.js"],"sourcesContent":["\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar getDomain = Promise._getDomain;\nvar util = require(\"./util\");\nvar tryCatch = util.tryCatch;\n\nfunction ReductionPromiseArray(promises, fn, initialValue, _each) {\n    this.constructor$(promises);\n    var domain = getDomain();\n    this._fn = domain === null ? fn : util.domainBind(domain, fn);\n    if (initialValue !== undefined) {\n        initialValue = Promise.resolve(initialValue);\n        initialValue._attachCancellationCallback(this);\n    }\n    this._initialValue = initialValue;\n    this._currentCancellable = null;\n    if(_each === INTERNAL) {\n        this._eachValues = Array(this._length);\n    } else if (_each === 0) {\n        this._eachValues = null;\n    } else {\n        this._eachValues = undefined;\n    }\n    this._promise._captureStackTrace();\n    this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._gotAccum = function(accum) {\n    if (this._eachValues !== undefined && \n        this._eachValues !== null && \n        accum !== INTERNAL) {\n        this._eachValues.push(accum);\n    }\n};\n\nReductionPromiseArray.prototype._eachComplete = function(value) {\n    if (this._eachValues !== null) {\n        this._eachValues.push(value);\n    }\n    return this._eachValues;\n};\n\nReductionPromiseArray.prototype._init = function() {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function() {\n    this._resolve(this._eachValues !== undefined ? this._eachValues\n                                                 : this._initialValue);\n};\n\nReductionPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n};\n\nReductionPromiseArray.prototype._resolve = function(value) {\n    this._promise._resolveCallback(value);\n    this._values = null;\n};\n\nReductionPromiseArray.prototype._resultCancelled = function(sender) {\n    if (sender === this._initialValue) return this._cancel();\n    if (this._isResolved()) return;\n    this._resultCancelled$();\n    if (this._currentCancellable instanceof Promise) {\n        this._currentCancellable.cancel();\n    }\n    if (this._initialValue instanceof Promise) {\n        this._initialValue.cancel();\n    }\n};\n\nReductionPromiseArray.prototype._iterate = function (values) {\n    this._values = values;\n    var value;\n    var i;\n    var length = values.length;\n    if (this._initialValue !== undefined) {\n        value = this._initialValue;\n        i = 0;\n    } else {\n        value = Promise.resolve(values[0]);\n        i = 1;\n    }\n\n    this._currentCancellable = value;\n\n    if (!value.isRejected()) {\n        for (; i < length; ++i) {\n            var ctx = {\n                accum: null,\n                value: values[i],\n                index: i,\n                length: length,\n                array: this\n            };\n            value = value._then(gotAccum, undefined, undefined, ctx, undefined);\n        }\n    }\n\n    if (this._eachValues !== undefined) {\n        value = value\n            ._then(this._eachComplete, undefined, undefined, this, undefined);\n    }\n    value._then(completed, completed, undefined, value, this);\n};\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n\nfunction completed(valueOrReason, array) {\n    if (this.isFulfilled()) {\n        array._resolve(valueOrReason);\n    } else {\n        array._reject(valueOrReason);\n    }\n}\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nfunction gotAccum(accum) {\n    this.accum = accum;\n    this.array._gotAccum(accum);\n    var value = tryConvertToPromise(this.value, this.array._promise);\n    if (value instanceof Promise) {\n        this.array._currentCancellable = value;\n        return value._then(gotValue, undefined, undefined, this, undefined);\n    } else {\n        return gotValue.call(this, value);\n    }\n}\n\nfunction gotValue(value) {\n    var array = this.array;\n    var promise = array._promise;\n    var fn = tryCatch(array._fn);\n    promise._pushContext();\n    var ret;\n    if (array._eachValues !== undefined) {\n        ret = fn.call(promise._boundValue(), value, this.index, this.length);\n    } else {\n        ret = fn.call(promise._boundValue(),\n                              this.accum, value, this.index, this.length);\n    }\n    if (ret instanceof Promise) {\n        array._currentCancellable = ret;\n    }\n    var promiseCreated = promise._popContext();\n    debug.checkForgottenReturns(\n        ret,\n        promiseCreated,\n        array._eachValues !== undefined ? \"Promise.each\" : \"Promise.reduce\",\n        promise\n    );\n    return ret;\n}\n};\n"],"names":["util","require$$0"],"mappings":"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"}