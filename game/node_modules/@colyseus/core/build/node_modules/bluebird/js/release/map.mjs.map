{"version":3,"file":"map.mjs","sources":["../../../../../../../node_modules/bluebird/js/release/map.js"],"sourcesContent":["\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar getDomain = Promise._getDomain;\nvar util = require(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nfunction MappingPromiseArray(promises, fn, limit, _filter) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    var domain = getDomain();\n    this._callback = domain === null ? fn : util.domainBind(domain, fn);\n    this._preservedValues = _filter === INTERNAL\n        ? new Array(this.length())\n        : null;\n    this._limit = limit;\n    this._inFlight = 0;\n    this._queue = [];\n    async.invoke(this._asyncInit, this, undefined);\n}\nutil.inherits(MappingPromiseArray, PromiseArray);\n\nMappingPromiseArray.prototype._asyncInit = function() {\n    this._init$(undefined, -2);\n};\n\nMappingPromiseArray.prototype._init = function () {};\n\nMappingPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var limit = this._limit;\n\n    if (index < 0) {\n        index = (index * -1) - 1;\n        values[index] = value;\n        if (limit >= 1) {\n            this._inFlight--;\n            this._drainQueue();\n            if (this._isResolved()) return true;\n        }\n    } else {\n        if (limit >= 1 && this._inFlight >= limit) {\n            values[index] = value;\n            this._queue.push(index);\n            return false;\n        }\n        if (preservedValues !== null) preservedValues[index] = value;\n\n        var promise = this._promise;\n        var callback = this._callback;\n        var receiver = promise._boundValue();\n        promise._pushContext();\n        var ret = tryCatch(callback).call(receiver, value, index, length);\n        var promiseCreated = promise._popContext();\n        debug.checkForgottenReturns(\n            ret,\n            promiseCreated,\n            preservedValues !== null ? \"Promise.filter\" : \"Promise.map\",\n            promise\n        );\n        if (ret === errorObj) {\n            this._reject(ret.e);\n            return true;\n        }\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            var bitField = maybePromise._bitField;\n            ;\n            if (((bitField & 50397184) === 0)) {\n                if (limit >= 1) this._inFlight++;\n                values[index] = maybePromise;\n                maybePromise._proxy(this, (index + 1) * -1);\n                return false;\n            } else if (((bitField & 33554432) !== 0)) {\n                ret = maybePromise._value();\n            } else if (((bitField & 16777216) !== 0)) {\n                this._reject(maybePromise._reason());\n                return true;\n            } else {\n                this._cancel();\n                return true;\n            }\n        }\n        values[index] = ret;\n    }\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= length) {\n        if (preservedValues !== null) {\n            this._filter(values, preservedValues);\n        } else {\n            this._resolve(values);\n        }\n        return true;\n    }\n    return false;\n};\n\nMappingPromiseArray.prototype._drainQueue = function () {\n    var queue = this._queue;\n    var limit = this._limit;\n    var values = this._values;\n    while (queue.length > 0 && this._inFlight < limit) {\n        if (this._isResolved()) return;\n        var index = queue.pop();\n        this._promiseFulfilled(values[index], index);\n    }\n};\n\nMappingPromiseArray.prototype._filter = function (booleans, values) {\n    var len = values.length;\n    var ret = new Array(len);\n    var j = 0;\n    for (var i = 0; i < len; ++i) {\n        if (booleans[i]) ret[j++] = values[i];\n    }\n    ret.length = j;\n    this._resolve(ret);\n};\n\nMappingPromiseArray.prototype.preservedValues = function () {\n    return this._preservedValues;\n};\n\nfunction map(promises, fn, options, _filter) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n\n    var limit = 0;\n    if (options !== undefined) {\n        if (typeof options === \"object\" && options !== null) {\n            if (typeof options.concurrency !== \"number\") {\n                return Promise.reject(\n                    new TypeError(\"'concurrency' must be a number but it is \" +\n                                    util.classString(options.concurrency)));\n            }\n            limit = options.concurrency;\n        } else {\n            return Promise.reject(new TypeError(\n                            \"options argument must be an object but it is \" +\n                             util.classString(options)));\n        }\n    }\n    limit = typeof limit === \"number\" &&\n        isFinite(limit) && limit >= 1 ? limit : 0;\n    return new MappingPromiseArray(promises, fn, limit, _filter).promise();\n}\n\nPromise.prototype.map = function (fn, options) {\n    return map(this, fn, options, null);\n};\n\nPromise.map = function (promises, fn, options, _filter) {\n    return map(promises, fn, options, _filter);\n};\n\n\n};\n"],"names":["util","require$$0"],"mappings":"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"}