{"version":3,"file":"join.js","sources":["../../../../../../../node_modules/bluebird/js/release/join.js"],"sourcesContent":["\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, tryConvertToPromise, INTERNAL, async,\n         getDomain) {\nvar util = require(\"./util\");\nvar canEvaluate = util.canEvaluate;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar reject;\n\nif (!false) {\nif (canEvaluate) {\n    var thenCallback = function(i) {\n        return new Function(\"value\", \"holder\", \"                             \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = value;                                           \\n\\\n            holder.checkFulfillment(this);                                   \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var promiseSetter = function(i) {\n        return new Function(\"promise\", \"holder\", \"                           \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = promise;                                         \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var generateHolderClass = function(total) {\n        var props = new Array(total);\n        for (var i = 0; i < props.length; ++i) {\n            props[i] = \"this.p\" + (i+1);\n        }\n        var assignment = props.join(\" = \") + \" = null;\";\n        var cancellationCode= \"var promise;\\n\" + props.map(function(prop) {\n            return \"                                                         \\n\\\n                promise = \" + prop + \";                                      \\n\\\n                if (promise instanceof Promise) {                            \\n\\\n                    promise.cancel();                                        \\n\\\n                }                                                            \\n\\\n            \";\n        }).join(\"\\n\");\n        var passedArguments = props.join(\", \");\n        var name = \"Holder$\" + total;\n\n\n        var code = \"return function(tryCatch, errorObj, Promise, async) {    \\n\\\n            'use strict';                                                    \\n\\\n            function [TheName](fn) {                                         \\n\\\n                [TheProperties]                                              \\n\\\n                this.fn = fn;                                                \\n\\\n                this.asyncNeeded = true;                                     \\n\\\n                this.now = 0;                                                \\n\\\n            }                                                                \\n\\\n                                                                             \\n\\\n            [TheName].prototype._callFunction = function(promise) {          \\n\\\n                promise._pushContext();                                      \\n\\\n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \\n\\\n                promise._popContext();                                       \\n\\\n                if (ret === errorObj) {                                      \\n\\\n                    promise._rejectCallback(ret.e, false);                   \\n\\\n                } else {                                                     \\n\\\n                    promise._resolveCallback(ret);                           \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype.checkFulfillment = function(promise) {       \\n\\\n                var now = ++this.now;                                        \\n\\\n                if (now === [TheTotal]) {                                    \\n\\\n                    if (this.asyncNeeded) {                                  \\n\\\n                        async.invoke(this._callFunction, this, promise);     \\n\\\n                    } else {                                                 \\n\\\n                        this._callFunction(promise);                         \\n\\\n                    }                                                        \\n\\\n                                                                             \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype._resultCancelled = function() {              \\n\\\n                [CancellationCode]                                           \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            return [TheName];                                                \\n\\\n        }(tryCatch, errorObj, Promise, async);                               \\n\\\n        \";\n\n        code = code.replace(/\\[TheName\\]/g, name)\n            .replace(/\\[TheTotal\\]/g, total)\n            .replace(/\\[ThePassedArguments\\]/g, passedArguments)\n            .replace(/\\[TheProperties\\]/g, assignment)\n            .replace(/\\[CancellationCode\\]/g, cancellationCode);\n\n        return new Function(\"tryCatch\", \"errorObj\", \"Promise\", \"async\", code)\n                           (tryCatch, errorObj, Promise, async);\n    };\n\n    var holderClasses = [];\n    var thenCallbacks = [];\n    var promiseSetters = [];\n\n    for (var i = 0; i < 8; ++i) {\n        holderClasses.push(generateHolderClass(i + 1));\n        thenCallbacks.push(thenCallback(i + 1));\n        promiseSetters.push(promiseSetter(i + 1));\n    }\n\n    reject = function (reason) {\n        this._reject(reason);\n    };\n}}\n\nPromise.join = function () {\n    var last = arguments.length - 1;\n    var fn;\n    if (last > 0 && typeof arguments[last] === \"function\") {\n        fn = arguments[last];\n        if (!false) {\n            if (last <= 8 && canEvaluate) {\n                var ret = new Promise(INTERNAL);\n                ret._captureStackTrace();\n                var HolderClass = holderClasses[last - 1];\n                var holder = new HolderClass(fn);\n                var callbacks = thenCallbacks;\n\n                for (var i = 0; i < last; ++i) {\n                    var maybePromise = tryConvertToPromise(arguments[i], ret);\n                    if (maybePromise instanceof Promise) {\n                        maybePromise = maybePromise._target();\n                        var bitField = maybePromise._bitField;\n                        ;\n                        if (((bitField & 50397184) === 0)) {\n                            maybePromise._then(callbacks[i], reject,\n                                               undefined, ret, holder);\n                            promiseSetters[i](maybePromise, holder);\n                            holder.asyncNeeded = false;\n                        } else if (((bitField & 33554432) !== 0)) {\n                            callbacks[i].call(ret,\n                                              maybePromise._value(), holder);\n                        } else if (((bitField & 16777216) !== 0)) {\n                            ret._reject(maybePromise._reason());\n                        } else {\n                            ret._cancel();\n                        }\n                    } else {\n                        callbacks[i].call(ret, maybePromise, holder);\n                    }\n                }\n\n                if (!ret._isFateSealed()) {\n                    if (holder.asyncNeeded) {\n                        var domain = getDomain();\n                        if (domain !== null) {\n                            holder.fn = util.domainBind(domain, holder.fn);\n                        }\n                    }\n                    ret._setAsyncGuaranteed();\n                    ret._setOnCancel(holder);\n                }\n                return ret;\n            }\n        }\n    }\n    var $_len = arguments.length;var args = new Array($_len); for(var $_i = 0; $_i < $_len; ++$_i) {args[$_i] = arguments[$_i];};\n    if (fn) args.pop();\n    var ret = new PromiseArray(args).promise();\n    return fn !== undefined ? ret.spread(fn) : ret;\n};\n\n};\n"],"names":["util","require$$0"],"mappings":"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"}