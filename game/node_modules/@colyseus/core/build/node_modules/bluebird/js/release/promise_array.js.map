{"version":3,"file":"promise_array.js","sources":["../../../../../../../node_modules/bluebird/js/release/promise_array.js"],"sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise,\n    apiRejection, Proxyable) {\nvar util = require(\"./util\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -2: return [];\n    case -3: return {};\n    case -6: return new Map();\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    if (values instanceof Promise) {\n        promise._propagateFrom(values, 3);\n    }\n    promise._setOnCancel(this);\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(undefined, -2);\n}\nutil.inherits(PromiseArray, Proxyable);\n\nPromiseArray.prototype.length = function () {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseArray.prototype._init = function init(_, resolveValueIfEmpty) {\n    var values = tryConvertToPromise(this._values, this._promise);\n    if (values instanceof Promise) {\n        values = values._target();\n        var bitField = values._bitField;\n        ;\n        this._values = values;\n\n        if (((bitField & 50397184) === 0)) {\n            this._promise._setAsyncGuaranteed();\n            return values._then(\n                init,\n                this._reject,\n                undefined,\n                this,\n                resolveValueIfEmpty\n           );\n        } else if (((bitField & 33554432) !== 0)) {\n            values = values._value();\n        } else if (((bitField & 16777216) !== 0)) {\n            return this._reject(values._reason());\n        } else {\n            return this._cancel();\n        }\n    }\n    values = util.asArray(values);\n    if (values === null) {\n        var err = apiRejection(\n            \"expecting an array or an iterable object but got \" + util.classString(values)).reason();\n        this._promise._rejectCallback(err, false);\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    this._iterate(values);\n};\n\nPromiseArray.prototype._iterate = function(values) {\n    var len = this.getActualLength(values.length);\n    this._length = len;\n    this._values = this.shouldCopyValues() ? new Array(len) : this._values;\n    var result = this._promise;\n    var isResolved = false;\n    var bitField = null;\n    for (var i = 0; i < len; ++i) {\n        var maybePromise = tryConvertToPromise(values[i], result);\n\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            bitField = maybePromise._bitField;\n        } else {\n            bitField = null;\n        }\n\n        if (isResolved) {\n            if (bitField !== null) {\n                maybePromise.suppressUnhandledRejections();\n            }\n        } else if (bitField !== null) {\n            if (((bitField & 50397184) === 0)) {\n                maybePromise._proxy(this, i);\n                this._values[i] = maybePromise;\n            } else if (((bitField & 33554432) !== 0)) {\n                isResolved = this._promiseFulfilled(maybePromise._value(), i);\n            } else if (((bitField & 16777216) !== 0)) {\n                isResolved = this._promiseRejected(maybePromise._reason(), i);\n            } else {\n                isResolved = this._promiseCancelled(i);\n            }\n        } else {\n            isResolved = this._promiseFulfilled(maybePromise, i);\n        }\n    }\n    if (!isResolved) result._setAsyncGuaranteed();\n};\n\nPromiseArray.prototype._isResolved = function () {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function (value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype._cancel = function() {\n    if (this._isResolved() || !this._promise._isCancellable()) return;\n    this._values = null;\n    this._promise._cancel();\n};\n\nPromiseArray.prototype._reject = function (reason) {\n    this._values = null;\n    this._promise._rejectCallback(reason, false);\n};\n\nPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n        return true;\n    }\n    return false;\n};\n\nPromiseArray.prototype._promiseCancelled = function() {\n    this._cancel();\n    return true;\n};\n\nPromiseArray.prototype._promiseRejected = function (reason) {\n    this._totalResolved++;\n    this._reject(reason);\n    return true;\n};\n\nPromiseArray.prototype._resultCancelled = function() {\n    if (this._isResolved()) return;\n    var values = this._values;\n    this._cancel();\n    if (values instanceof Promise) {\n        values.cancel();\n    } else {\n        for (var i = 0; i < values.length; ++i) {\n            if (values[i] instanceof Promise) {\n                values[i].cancel();\n            }\n        }\n    }\n};\n\nPromiseArray.prototype.shouldCopyValues = function () {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength = function (len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n"],"names":["util","require$$0"],"mappings":"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"}