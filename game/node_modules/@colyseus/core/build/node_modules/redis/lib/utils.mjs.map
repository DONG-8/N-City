{"version":3,"file":"utils.mjs","sources":["../../../../../../node_modules/redis/lib/utils.js"],"sourcesContent":["'use strict';\n\n// hgetall converts its replies to an Object. If the reply is empty, null is returned.\n// These function are only called with internal data and have therefore always the same instanceof X\nfunction replyToObject (reply) {\n    // The reply might be a string or a buffer if this is called in a transaction (multi)\n    if (reply.length === 0 || !(reply instanceof Array)) {\n        return null;\n    }\n    var obj = {};\n    for (var i = 0; i < reply.length; i += 2) {\n        obj[reply[i].toString('binary')] = reply[i + 1];\n    }\n    return obj;\n}\n\nfunction replyToStrings (reply) {\n    if (reply instanceof Buffer) {\n        return reply.toString();\n    }\n    if (reply instanceof Array) {\n        var res = new Array(reply.length);\n        for (var i = 0; i < reply.length; i++) {\n            // Recusivly call the function as slowlog returns deep nested replies\n            res[i] = replyToStrings(reply[i]);\n        }\n        return res;\n    }\n\n    return reply;\n}\n\nfunction print (err, reply) {\n    if (err) {\n        // A error always begins with Error:\n        console.log(err.toString());\n    } else {\n        console.log('Reply: ' + reply);\n    }\n}\n\nvar camelCase;\n// Deep clone arbitrary objects with arrays. Can't handle cyclic structures (results in a range error)\n// Any attribute with a non primitive value besides object and array will be passed by reference (e.g. Buffers, Maps, Functions)\n// All capital letters are going to be replaced with a lower case letter and a underscore infront of it\nfunction clone (obj) {\n    var copy;\n    if (Array.isArray(obj)) {\n        copy = new Array(obj.length);\n        for (var i = 0; i < obj.length; i++) {\n            copy[i] = clone(obj[i]);\n        }\n        return copy;\n    }\n    if (Object.prototype.toString.call(obj) === '[object Object]') {\n        copy = {};\n        var elems = Object.keys(obj);\n        var elem;\n        while (elem = elems.pop()) {\n            if (elem === 'tls') { // special handle tls\n                copy[elem] = obj[elem];\n                continue;\n            }\n            // Accept camelCase options and convert them to snake_case\n            var snake_case = elem.replace(/[A-Z][^A-Z]/g, '_$&').toLowerCase();\n            // If camelCase is detected, pass it to the client, so all variables are going to be camelCased\n            // There are no deep nested options objects yet, but let's handle this future proof\n            if (snake_case !== elem.toLowerCase()) {\n                camelCase = true;\n            }\n            copy[snake_case] = clone(obj[elem]);\n        }\n        return copy;\n    }\n    return obj;\n}\n\nfunction convenienceClone (obj) {\n    camelCase = false;\n    obj = clone(obj) || {};\n    if (camelCase) {\n        obj.camel_case = true;\n    }\n    return obj;\n}\n\nfunction callbackOrEmit (self, callback, err, res) {\n    if (callback) {\n        callback(err, res);\n    } else if (err) {\n        self.emit('error', err);\n    }\n}\n\nfunction replyInOrder (self, callback, err, res, queue) {\n    // If the queue is explicitly passed, use that, otherwise fall back to the offline queue first,\n    // as there might be commands in both queues at the same time\n    var command_obj;\n    /* istanbul ignore if: TODO: Remove this as soon as we test Redis 3.2 on travis */\n    if (queue) {\n        command_obj = queue.peekBack();\n    } else {\n        command_obj = self.offline_queue.peekBack() || self.command_queue.peekBack();\n    }\n    if (!command_obj) {\n        process.nextTick(function () {\n            callbackOrEmit(self, callback, err, res);\n        });\n    } else {\n        var tmp = command_obj.callback;\n        command_obj.callback = tmp ?\n            function (e, r) {\n                tmp(e, r);\n                callbackOrEmit(self, callback, err, res);\n            } :\n            function (e, r) {\n                if (e) {\n                    self.emit('error', e);\n                }\n                callbackOrEmit(self, callback, err, res);\n            };\n    }\n}\n\nmodule.exports = {\n    reply_to_strings: replyToStrings,\n    reply_to_object: replyToObject,\n    print: print,\n    err_code: /^([A-Z]+)\\s+(.+)$/,\n    monitor_regex: /^[0-9]{10,11}\\.[0-9]+ \\[[0-9]+ .+\\]( \".+?\")+$/,\n    clone: convenienceClone,\n    callback_or_emit: callbackOrEmit,\n    reply_in_order: replyInOrder\n};\n"],"names":[],"mappings":"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"}