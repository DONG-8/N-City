{"version":3,"file":"extendedApi.js","sources":["../../../../../../node_modules/redis/lib/extendedApi.js"],"sourcesContent":["'use strict';\n\nvar utils = require('./utils');\nvar debug = require('./debug');\nvar RedisClient = require('../').RedisClient;\nvar Command = require('./command');\nvar noop = function () {};\n\n/**********************************************\nAll documented and exposed API belongs in here\n**********************************************/\n\n// Redirect calls to the appropriate function and use to send arbitrary / not supported commands\nRedisClient.prototype.send_command = RedisClient.prototype.sendCommand = function (command, args, callback) {\n    // Throw to fail early instead of relying in order in this case\n    if (typeof command !== 'string') {\n        throw new TypeError('Wrong input type \"' + (command !== null && command !== undefined ? command.constructor.name : command) + '\" for command name');\n    }\n    command = command.toLowerCase();\n    if (!Array.isArray(args)) {\n        if (args === undefined || args === null) {\n            args = [];\n        } else if (typeof args === 'function' && callback === undefined) {\n            callback = args;\n            args = [];\n        } else {\n            throw new TypeError('Wrong input type \"' + args.constructor.name + '\" for args');\n        }\n    }\n    if (typeof callback !== 'function' && callback !== undefined) {\n        throw new TypeError('Wrong input type \"' + (callback !== null ? callback.constructor.name : 'null') + '\" for callback function');\n    }\n\n    // Using the raw multi command is only possible with this function\n    // If the command is not yet added to the client, the internal function should be called right away\n    // Otherwise we need to redirect the calls to make sure the internal functions don't get skipped\n    // The internal functions could actually be used for any non hooked function\n    // but this might change from time to time and at the moment there's no good way to distinguish them\n    // from each other, so let's just do it do it this way for the time being\n    if (command === 'multi' || typeof this[command] !== 'function') {\n        return this.internal_send_command(new Command(command, args, callback));\n    }\n    if (typeof callback === 'function') {\n        args = args.concat([callback]); // Prevent manipulating the input array\n    }\n    return this[command].apply(this, args);\n};\n\nRedisClient.prototype.end = function (flush) {\n    // Flush queue if wanted\n    if (flush) {\n        this.flush_and_error({\n            message: 'Connection forcefully ended and command aborted.',\n            code: 'NR_CLOSED'\n        });\n    } else if (arguments.length === 0) {\n        this.warn(\n            'Using .end() without the flush parameter is deprecated and throws from v.3.0.0 on.\\n' +\n            'Please check the doku (https://github.com/NodeRedis/node_redis) and explictly use flush.'\n        );\n    }\n    // Clear retry_timer\n    if (this.retry_timer) {\n        clearTimeout(this.retry_timer);\n        this.retry_timer = null;\n    }\n    this.stream.removeAllListeners();\n    this.stream.on('error', noop);\n    this.connected = false;\n    this.ready = false;\n    this.closing = true;\n    return this.stream.destroySoon();\n};\n\nRedisClient.prototype.unref = function () {\n    if (this.connected) {\n        debug(\"Unref'ing the socket connection\");\n        this.stream.unref();\n    } else {\n        debug('Not connected yet, will unref later');\n        this.once('connect', function () {\n            this.unref();\n        });\n    }\n};\n\nRedisClient.prototype.duplicate = function (options, callback) {\n    if (typeof options === 'function') {\n        callback = options;\n        options = null;\n    }\n    var existing_options = utils.clone(this.options);\n    options = utils.clone(options);\n    for (var elem in options) {\n        existing_options[elem] = options[elem];\n    }\n    var client = new RedisClient(existing_options);\n    client.selected_db = this.selected_db;\n    if (typeof callback === 'function') {\n        var ready_listener = function () {\n            callback(null, client);\n            client.removeAllListeners(error_listener);\n        };\n        var error_listener = function (err) {\n            callback(err);\n            client.end(true);\n        };\n        client.once('ready', ready_listener);\n        client.once('error', error_listener);\n        return;\n    }\n    return client;\n};\n"],"names":["require$$0","command","Command"],"mappings":";;;;;;;AAIA,IAAI,WAAW,GAAGA,KAAc,CAAC,WAAW,CAAC;AACV;AACnC,IAAI,IAAI,GAAG,YAAY,EAAE,CAAC;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,CAAC,SAAS,CAAC,YAAY,GAAG,WAAW,CAAC,SAAS,CAAC,WAAW,GAAG,UAAUC,SAAO,EAAE,IAAI,EAAE,QAAQ,EAAE;AAC5G;AACA,IAAI,IAAI,OAAOA,SAAO,KAAK,QAAQ,EAAE;AACrC,QAAQ,MAAM,IAAI,SAAS,CAAC,oBAAoB,IAAIA,SAAO,KAAK,IAAI,IAAIA,SAAO,KAAK,SAAS,GAAGA,SAAO,CAAC,WAAW,CAAC,IAAI,GAAGA,SAAO,CAAC,GAAG,oBAAoB,CAAC,CAAC;AAC5J,KAAK;AACL,IAAIA,SAAO,GAAGA,SAAO,CAAC,WAAW,EAAE,CAAC;AACpC,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;AAC9B,QAAQ,IAAI,IAAI,KAAK,SAAS,IAAI,IAAI,KAAK,IAAI,EAAE;AACjD,YAAY,IAAI,GAAG,EAAE,CAAC;AACtB,SAAS,MAAM,IAAI,OAAO,IAAI,KAAK,UAAU,IAAI,QAAQ,KAAK,SAAS,EAAE;AACzE,YAAY,QAAQ,GAAG,IAAI,CAAC;AAC5B,YAAY,IAAI,GAAG,EAAE,CAAC;AACtB,SAAS,MAAM;AACf,YAAY,MAAM,IAAI,SAAS,CAAC,oBAAoB,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,GAAG,YAAY,CAAC,CAAC;AAC7F,SAAS;AACT,KAAK;AACL,IAAI,IAAI,OAAO,QAAQ,KAAK,UAAU,IAAI,QAAQ,KAAK,SAAS,EAAE;AAClE,QAAQ,MAAM,IAAI,SAAS,CAAC,oBAAoB,IAAI,QAAQ,KAAK,IAAI,GAAG,QAAQ,CAAC,WAAW,CAAC,IAAI,GAAG,MAAM,CAAC,GAAG,yBAAyB,CAAC,CAAC;AACzI,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,IAAIA,SAAO,KAAK,OAAO,IAAI,OAAO,IAAI,CAACA,SAAO,CAAC,KAAK,UAAU,EAAE;AACpE,QAAQ,OAAO,IAAI,CAAC,qBAAqB,CAAC,IAAIC,OAAO,CAACD,SAAO,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC,CAAC;AAChF,KAAK;AACL,IAAI,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;AACxC,QAAQ,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;AACvC,KAAK;AACL,IAAI,OAAO,IAAI,CAACA,SAAO,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAC3C,CAAC,CAAC;AACF;AACA,WAAW,CAAC,SAAS,CAAC,GAAG,GAAG,UAAU,KAAK,EAAE;AAC7C;AACA,IAAI,IAAI,KAAK,EAAE;AACf,QAAQ,IAAI,CAAC,eAAe,CAAC;AAC7B,YAAY,OAAO,EAAE,kDAAkD;AACvE,YAAY,IAAI,EAAE,WAAW;AAC7B,SAAS,CAAC,CAAC;AACX,KAAK,MAAM,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE;AACvC,QAAQ,IAAI,CAAC,IAAI;AACjB,YAAY,sFAAsF;AAClG,YAAY,0FAA0F;AACtG,SAAS,CAAC;AACV,KAAK;AACL;AACA,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE;AAC1B,QAAQ,YAAY,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;AACvC,QAAQ,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;AAChC,KAAK;AACL,IAAI,IAAI,CAAC,MAAM,CAAC,kBAAkB,EAAE,CAAC;AACrC,IAAI,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;AAClC,IAAI,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;AAC3B,IAAI,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;AACvB,IAAI,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;AACxB,IAAI,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC;AACrC,CAAC,CAAC;AACF;AACA,WAAW,CAAC,SAAS,CAAC,KAAK,GAAG,YAAY;AAC1C,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE;AACxB,QAAQ,KAAK,CAAC,iCAAiC,CAAC,CAAC;AACjD,QAAQ,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;AAC5B,KAAK,MAAM;AACX,QAAQ,KAAK,CAAC,qCAAqC,CAAC,CAAC;AACrD,QAAQ,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,YAAY;AACzC,YAAY,IAAI,CAAC,KAAK,EAAE,CAAC;AACzB,SAAS,CAAC,CAAC;AACX,KAAK;AACL,CAAC,CAAC;AACF;AACA,WAAW,CAAC,SAAS,CAAC,SAAS,GAAG,UAAU,OAAO,EAAE,QAAQ,EAAE;AAC/D,IAAI,IAAI,OAAO,OAAO,KAAK,UAAU,EAAE;AACvC,QAAQ,QAAQ,GAAG,OAAO,CAAC;AAC3B,QAAQ,OAAO,GAAG,IAAI,CAAC;AACvB,KAAK;AACL,IAAI,IAAI,gBAAgB,GAAG,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACrD,IAAI,OAAO,GAAG,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACnC,IAAI,KAAK,IAAI,IAAI,IAAI,OAAO,EAAE;AAC9B,QAAQ,gBAAgB,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AAC/C,KAAK;AACL,IAAI,IAAI,MAAM,GAAG,IAAI,WAAW,CAAC,gBAAgB,CAAC,CAAC;AACnD,IAAI,MAAM,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;AAC1C,IAAI,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;AACxC,QAAQ,IAAI,cAAc,GAAG,YAAY;AACzC,YAAY,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;AACnC,YAAY,MAAM,CAAC,kBAAkB,CAAC,cAAc,CAAC,CAAC;AACtD,SAAS,CAAC;AACV,QAAQ,IAAI,cAAc,GAAG,UAAU,GAAG,EAAE;AAC5C,YAAY,QAAQ,CAAC,GAAG,CAAC,CAAC;AAC1B,YAAY,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AAC7B,SAAS,CAAC;AACV,QAAQ,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;AAC7C,QAAQ,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;AAC7C,QAAQ,OAAO;AACf,KAAK;AACL,IAAI,OAAO,MAAM,CAAC;AAClB,CAAC;;"}